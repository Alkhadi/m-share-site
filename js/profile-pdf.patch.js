(()=>{function rr(c,x,y,w,h,r){r=Math.min(r,w/2,h/2);c.beginPath();c.moveTo(x+r,y);c.arcTo(x+w,y,x+w,y+h,r);c.arcTo(x+w,y+h,x,y+h,r);c.arcTo(x,y+h,x,y,r);c.arcTo(x,y,x+w,y,r);c.closePath()}
async function loadImg(s){return await new Promise((res,rej)=>{const i=new Image();i.crossOrigin='anonymous';i.onload=()=>res(i);i.onerror=rej;i.src=s})}
async function makeQR(u,z){const i=new Image();i.crossOrigin='anonymous';i.referrerPolicy='no-referrer';i.src='https://api.qrserver.com/v1/create-qr-code/?size='+(z||240)+'x'+(z||240)+'&data='+encodeURIComponent(u);await new Promise(r=>{i.onload=r;i.onerror=r});const c=document.createElement('canvas');c.width=z||240;c.height=z||240;const x=c.getContext('2d');x.fillStyle='#fff';x.fillRect(0,0,c.width,c.height);try{x.drawImage(i,0,0,c.width,c.height)}catch{}return c}
function dl(name,blob){const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=name;document.body.appendChild(a);a.click();a.remove();setTimeout(()=>URL.revokeObjectURL(a.href),1200)}
function cssVar(k,f){const v=getComputedStyle(document.documentElement).getPropertyValue(k).trim();return v||f}
function wait(ms){return new Promise(r=>setTimeout(r,ms))}
(async function init(){let t=0;while(!(window.__MSHARE__&&window.__MSHARE__.generateStyledPdf)&&t<80){await wait(50);t++}const MS=window.__MSHARE__;if(!MS)return;
MS.buildStyledCardCanvas=async function({includeQR=true}={}){const W=1224,H=1584;const cnv=Object.assign(document.createElement('canvas'),{width:W,height:H});const ctx=cnv.getContext('2d');const bg=cssVar('--app-bg','#0f172a');ctx.fillStyle=bg;ctx.fillRect(0,0,W,H);const g=ctx.createLinearGradient(0,0,0,H);g.addColorStop(0,'rgba(255,255,255,.06)');g.addColorStop(1,'rgba(0,0,0,.35)');ctx.fillStyle=g;ctx.fillRect(0,0,W,H);const d=MS.data||{};let y=120;try{const av=await loadImg(d.avatar||'assets/alkhadi.png');const S=320;const cx=W/2;ctx.save();ctx.beginPath();ctx.arc(cx,y+S/2,S/2,0,Math.PI*2);ctx.closePath();ctx.fillStyle='rgba(255,255,255,.08)';ctx.fill();ctx.clip();ctx.drawImage(av,cx-S/2,y,S,S);ctx.restore();ctx.lineWidth=8;ctx.strokeStyle='rgba(255,255,255,.92)';ctx.beginPath();ctx.arc(cx,y+S/2,S/2,0,Math.PI*2);ctx.stroke();y+=S+40}catch{y+=40}
ctx.textAlign='center';ctx.fillStyle='#fff';ctx.font='700 60px ui-sans-serif,system-ui,Segoe UI,Roboto';ctx.fillText(d.name||'Alkhadi Koroma',W/2,y);y+=68;ctx.font='600 34px ui-sans-serif,system-ui,Segoe UI,Roboto';ctx.fillStyle='rgba(236,253,245,.95)';ctx.fillText(d.title||'Professional Title · Flutter Developer',W/2,y);y+=40;const btns=[{label:'📞 Call',url:(d.phone?('tel:'+d.phone):'')},{label:'✉️ Email',url:(d.email?('mailto:'+d.email):'')},{label:'🌐 Website',url:(d.site||'')}];const links=[];const bw=460,bh=90,gap=18,bx=(W-bw)/2;ctx.font='600 30px ui-sans-serif,system-ui,Segoe UI,Roboto';btns.forEach((b,i)=>{const by=y+i*(bh+gap);ctx.fillStyle='rgba(0,0,0,.35)';ctx.strokeStyle='rgba(255,255,255,.5)';ctx.lineWidth=2;rr(ctx,bx,by,bw,bh,16);ctx.fill();ctx.stroke();ctx.fillStyle='#e5f7ff';ctx.fillText(b.label,W/2,by+bh/2+10);links.push({x:bx,y:by,w:bw,h:bh,url:b.url})});y+=btns.length*(bh+gap)+30;if(includeQR){const qp=MS.qp||'';const dest=location.origin+location.pathname.replace(/[^/]*$/,'')+'about.html'+qp;const qr=await makeQR(dest,280);const qx=(W-qr.width)/2,qy=Math.min(H-qr.height-80,y);cnv.getContext('2d').drawImage(qr,qx,qy);links.push({x:qx,y:qy,w:qr.width,h:qr.height,url:dest})}return{canvas:cnv,links}}
MS.quickDownloadPdf=async function(){try{const r=await MS.buildStyledCardCanvas({includeQR:true});const blob=await MS.generateStyledPdf({fromCanvas:r.canvas,links:r.links});dl('profile.pdf',blob)}catch(e){try{const f=await fetch('assets/m_share_profile.pdf').catch(()=>null);if(f&&f.ok){const b=await f.blob();dl('profile.pdf',b)}}catch{}}}
})()})();
