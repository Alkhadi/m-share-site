<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1"
    />
    <title>Dyslexia Reading Training • M Share</title>
    <meta
      name="description"
      content="Free, structured reading practice ideas paired with calming breath tools and adult‑friendly micro‑exercises."
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="container navbar">
        <a class="brand" href="index.html">M Share</a>
        <nav class="main-nav">
          <a href="index.html">Wellbeing</a>
          <a href="pdf.html">About</a>
          <a href="dyslexia-reading-training.html">Dyslexia</a>
          <a href="autism.html">Autism</a>
          <a href="depression.html">Depression</a>
          <a href="mood.html">Mood</a>
          <a href="coffee.html">Support Us</a>
          <a href="contact.html">Contact</a>
        </nav>
      </div> 
    </header>

    <main class="container" id="dlxPage">
      <h1>Dyslexia: Reading Training</h1>

      <div class="card">
        <p>
          These are practical, low‑pressure routines that blend
          <strong>paced breathing</strong> with
          <strong>sound, word, and visual‑scanning practice</strong>. The aim is
          steadier focus, less overload, and small wins that add up. Adapt
          minutes, difficulty, and text to suit the person.
        </p>
        <p class="muted">
          Educational information only; not medical advice or a diagnosis.
        </p>
      </div>

      <!-- (Removed: Account / login / activation block) -->

      <h2>Before practice (1–2 minutes)</h2>
      <ul>
        <li>
          Do one calming breath: <strong>4‑7‑8</strong> (inhale 4s, hold 7s, exhale 8s) or
          <strong>Coherent 5‑5</strong> (inhale 5s, exhale 5s).
        </li>
        <!-- quick links -->
        <li style="list-style: none; margin: 0.5rem 0 0 0">
          <div class="actions">
            <a
              class="btn btn-success"
              href="4-7-8-breathing.html"
              data-href="4-7-8-breathing.html"
              >Start 4‑7‑8 Breathing</a
            >
            <a
              class="btn btn-success"
              href="coherent-5-5.html"
              data-href="coherent-5-5.html"
              >Start Coherent 5‑5</a
            >
          </div>
        </li>
        <li>Pick a <em>tiny</em> goal (e.g., 60 seconds, 3 words, or 2 short lines).</li>
        <li>Stop while it still feels easy—<em>bank the win</em> and come back tomorrow.</li>
      </ul>

      <h2>Core drills</h2>

      <!-- 1) Phonological awareness -->
      <div class="card" id="sec-phon">
        <h3>1) Phonological awareness</h3>
        <p class="muted">
          <strong>Why it helps:</strong> noticing, separating, and blending sounds builds a base for
          decoding new words.
        </p>

        <h4>Sound map</h4>
        <p>
          Choose 3–5 graphemes (e.g., <em>a, sh, ai</em>). Point to a tile out of order and say its
          sound. Do 3 slow breaths, then a quick re‑run.
        </p>

        <h4>Segment → Blend (how to blend slowly)</h4>
        <ol>
          <li>
            <strong>Stretch the sounds</strong> with a finger count:
            <em>/k/</em> (1) — <em>/a/</em> (2) — <em>/t/</em> (3).
          </li>
          <li>
            <strong>Blend forward:</strong> say the first two together (<em>ka…</em>), then pull in
            the last (<em>kat</em> → “<em>cat</em>”).
          </li>
          <li>
            <strong>Use a breath cue:</strong> inhale before the first sound, exhale gently through
            the blend to avoid rushing.
          </li>
          <li><strong>Swap roles:</strong> partner segments while you blend.</li>
        </ol>

        <h4>Onset–rime (pair the first sound)</h4>
        <ol>
          <li>
            Write rimes (<em>-at, -an, -ap, -it, -og</em>) in a column. Slide onsets
            (<em>c, b, s, p, m, tr</em>) across the front.
          </li>
          <li>
            Read each pair as a whole word (not letter‑by‑letter):
            <em>c‑ + -at → cat</em>. Keep the voice smooth.
          </li>
          <li>Mix new onsets and repeat for 1–2 minutes. Celebrate two clean blends in a row.</li>
        </ol>

        <!-- Voice Coach for Segment→Blend -->
        <div id="vcPhon" class="card" aria-labelledby="vcPhonH">
          <h4 id="vcPhonH">Voice Coach — Segment &amp; Blend</h4>
          <p class="muted">Type a word and let the coach model slow sounds then the whole word.</p>
          <div class="grid cols-3" style="gap:10px">
            <div class="tile">
              <label for="vcWord">Word</label>
              <input id="vcWord" type="text" value="cat" />
            </div>
            <div class="tile">
              <label for="vcPace">Pace</label>
              <select id="vcPace">
                <option value="slow">Slow</option>
                <option value="med" selected>Medium</option>
                <option value="fast">Fast</option>
              </select>
            </div>
            <div class="tile">
              <label>&nbsp;</label>
              <div class="actions">
                <button id="vcPlay" class="btn btn-success" type="button">Model segment→blend</button>
                <button id="vcStop" class="btn" type="button" disabled>Stop</button>
              </div>
            </div>
          </div>
          <div id="vcOut" class="muted" style="margin-top:6px"></div>
        </div>
      </div>

      <!-- 2) GP mapping -->
      <div class="card" id="sec-gp">
        <h3>2) Grapheme–phoneme practice (GP mapping)</h3>
        <p class="muted">
          <strong>Why it helps:</strong> fluent mapping turns symbols into reliable sounds.
        </p>

        <p><strong>Rotate sets over the week.</strong> Keep each mini‑set short (3–6 items).</p>

        <!-- 3x2 grid exactly -->
        <div
          class="grid"
          style="display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 10px"
        >
          <div class="tile">
            <h4>Short vowels</h4>
            <ul>
              <li><strong>a</strong> /a/ — <em>cat, map</em></li>
              <li><strong>e</strong> /e/ — <em>bed, hem</em></li>
              <li><strong>i</strong> /i/ — <em>sit, milk</em></li>
              <li><strong>o</strong> /o/ — <em>hot, pond</em></li>
              <li><strong>u</strong> /u/ — <em>sun, drum</em></li>
            </ul>
          </div>

          <div class="tile">
            <h4>Long vowels</h4>
            <ul>
              <li><strong>a</strong> /ā/ — <em>late, paper</em></li>
              <li><strong>e</strong> /ē/ — <em>tree, even</em></li>
              <li><strong>i</strong> /ī/ — <em>time, pilot</em></li>
              <li><strong>o</strong> /ō/ — <em>home, open</em></li>
              <li><strong>u</strong> /yoo/ — <em>unit, music</em></li>
            </ul>
          </div>

          <div class="tile">
            <h4>Digraphs / trigraphs</h4>
            <p class="muted"><em>sh, ch, th, ph, wh, igh, tch, dge</em></p>
            <ul>
              <li><strong>sh</strong> — <em>ship, brush</em></li>
              <li><strong>ch</strong> — <em>chat, teacher</em></li>
              <li><strong>th</strong> (/θ/ or /ð/) — <em>thin, this</em></li>
              <li><strong>ph</strong> — <em>phone, graph</em></li>
              <li><strong>wh</strong> — <em>when, whale</em></li>
              <li><strong>igh</strong> — <em>high, night</em></li>
              <li><strong>tch</strong> — <em>catch, match</em></li>
              <li><strong>dge</strong> — <em>bridge, edge</em></li>
            </ul>
          </div>

          <div class="tile">
            <h4>Vowel teams</h4>
            <p class="muted"><em>ai/ay, ee/ea, oa/ow, oi/oy, ou/ow, au/aw</em></p>
            <ul>
              <li><strong>ai/ay</strong> — <em>rain / day</em></li>
              <li><strong>ee/ea</strong> — <em>see / team</em></li>
              <li><strong>oa/ow</strong> — <em>boat / snow</em></li>
              <li><strong>oi/oy</strong> — <em>coin / boy</em></li>
              <li><strong>ou/ow</strong> — <em>sound / cloud</em></li>
              <li><strong>au/aw</strong> — <em>cause / saw</em></li>
            </ul>
          </div>

          <div class="tile">
            <h4>R‑controlled vowels</h4>
            <p class="muted"><em>ar, er, ir, or, ur</em></p>
            <ul>
              <li><strong>ar</strong> — <em>car, start</em></li>
              <li><strong>er/ir/ur</strong> — <em>her, bird, turn</em></li>
              <li><strong>or</strong> — <em>fork, north</em></li>
            </ul>
          </div>

          <div class="tile">
            <h4>Silent letters</h4>
            <p class="muted"><em>kn/gn, wr, mb, igh, tch</em></p>
            <ul>
              <li><strong>kn/gn</strong> — <em>knee, gnome</em></li>
              <li><strong>wr</strong> — <em>write, wrist</em></li>
              <li><strong>mb</strong> — <em>thumb, comb</em></li>
              <li><strong>igh</strong> — <em>light</em> (single sound /ī/)</li>
            </ul>
          </div>
        </div>

        <p>
          <strong>How to run (1–3 min):</strong> show the set, speak the sound, read two quick
          example words, then hide and recall.
        </p>

        <!-- Sound Training Studio: extended sets + UK voice choice -->
        <div id="svStudio" class="card" aria-labelledby="svStudioH">
          <h4 id="svStudioH">Sound Training Studio (Audio • Visual • Mirror)</h4>
          <p class="muted">
            Select a topic, click a sound to hear examples, and—if helpful—open the
            mirror to watch mouth shape. Works fully offline with your device’s built‑in speech.
          </p>
          <div class="grid cols-3" style="gap: 10px">
            <div class="tile">
              <label for="svSelect">Topic</label>
              <select id="svSelect">
                <option value="short" selected>Short vowels</option>
                <option value="long">Long vowels</option>
                <option value="digraphs">Digraphs / trigraphs</option>
                <option value="teams">Vowel teams</option>
                <option value="r">R‑controlled</option>
                <option value="silent">Silent letters</option>
              </select>
            </div>
            <div class="tile">
              <label for="ttsVoice">Voice</label>
              <select id="ttsVoice">
                <option value="uk-auto" selected>Auto (best UK)</option>
                <option value="uk-f">British Female</option>
                <option value="uk-m">British Male</option>
                <option value="system">System default</option>
              </select>
            </div>
            <div class="tile">
              <label>&nbsp;</label>
              <div class="actions">
                <button id="svPractice" class="btn btn-success" type="button" disabled>
                  Practice all
                </button>
                <button id="svStop" class="btn" type="button" disabled>Stop</button>
              </div>
            </div>
            <div class="tile">
              <label>&nbsp;</label>
              <div class="actions">
                <button id="svCam" class="btn" type="button">Open mirror</button>
                <button id="svCamOff" class="btn" type="button" disabled>Close mirror</button>
              </div>
            </div>
          </div>

          <div
            id="svTiles"
            class="grid"
            style="
              display: grid;
              grid-template-columns: repeat(auto-fill, minmax(84px, 1fr));
              gap: 8px;
              margin-top: 8px;
            "
          ></div>

          <div id="svOut" class="muted" style="margin-top: 8px"></div>

          <div
            id="svMirrorWrap"
            class="card"
            style="margin-top: 10px; display: none"
            aria-label="Mirror camera preview for mouth shape practice"
          >
            <video
              id="svMirror"
              autoplay
              playsinline
              muted
              style="width: 100%; border-radius: 12px; background: #000"
            ></video>
            <p class="muted" style="margin-top: 6px">
              Use this as a mirror while you say the sounds; keep jaw/shoulders relaxed and airflow
              steady.
            </p>
          </div>
        </div>

        <!-- Quick cues -->
        <div class="card">
          <h4>Pronunciation coaching (quick cues)</h4>
          <ul>
            <li>
              <strong>Mouth shape:</strong> long vowels stretch; short vowels are quick and centred.
            </li>
            <li>
              <strong>Voicing:</strong> touch your throat—<em>/z/</em> vibrates, <em>/s/</em> does
              not; <em>then/thing</em> contrasts voiced/unvoiced <em>th</em>.
            </li>
            <li>
              <strong>Airflow:</strong> <em>sh</em> is a long, quiet stream; <em>ch</em> starts with
              a tiny stop then a release.
            </li>
          </ul>
        </div>

        <!-- Pronunciation Lab -->
        <div class="card" id="pronLab" aria-labelledby="pronLabH">
          <h4 id="pronLabH">Pronunciation Lab (TTS)</h4>
          <p class="muted">
            Tap a sound to hear it and see examples. If speech is blocked, a message appears
            instead.
          </p>
          <div
            class="grid"
            style="
              display: grid;
              grid-template-columns: repeat(auto-fill, minmax(72px, 1fr));
              gap: 8px;
            "
          ></div>
          <div id="pronOut" class="muted" style="margin-top: 8px"></div>
          <div class="actions" style="margin-top: 8px">
            <button id="pronPractice" class="btn" type="button" disabled>Practice examples</button>
            <button id="pronStop" class="btn" type="button" disabled>Stop</button>
          </div>
        </div>
      </div>

      <!-- 3) Word ladders & morphology -->
      <div class="card" id="sec-ladders">
        <h3>3) Word ladders &amp; light morphology</h3>
        <p class="muted">
          <strong>Why it helps:</strong> small changes sharpen attention to patterns and “meaning
          chunks.”
        </p>

        <!-- one row, two columns -->
        <div
          class="grid"
          style="display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 10px"
        >
          <div class="tile">
            <h4>Letter change ladders</h4>
            <ul>
              <li><em>cat → cot → coat → coast → toast → boast</em></li>
              <li><em>pin → pan → pain → plain → plane</em></li>
              <li><em>hop → hope → hose → those</em></li>
              <li><em>light → right → fright → bright</em></li>
            </ul>
          </div>

          <div class="tile">
            <h4>Prefixes / suffixes</h4>
            <ul>
              <li>Base <em>help</em> → <em>rehelp, helpful, helpless, unhelpful</em></li>
              <li>Base <em>move</em> → <em>remove, improve, movement</em></li>
              <li>Base <em>use</em> → <em>reuse, useful, useless</em></li>
              <li>Base <em>clear</em> → <em>unclear, clarify, clearly</em></li>
            </ul>
          </div>
        </div>

        <p>
          <strong>How to practise (1–3 min):</strong> say each step aloud; notice which letter(s)
          changed and how the sound changed. If a step feels tricky, take one slow breath and repeat
          once.
        </p>

        <div class="card">
          <h4>Learning the sounds while you build</h4>
          <ul>
            <li>Say the <em>new</em> letter or team by itself (<em>oa</em> → /ō/), then the whole word.</li>
            <li>Keep a mini “sound bank” of the patterns you used today; review tomorrow.</li>
          </ul>
        </div>

        <!-- Voice Coach for ladders & affixes -->
        <div id="vcLadder" class="card" aria-labelledby="vcLadderH">
          <h4 id="vcLadderH">Voice Coach — Ladders &amp; Affixes</h4>
          <div class="grid cols-3" style="gap:10px">
            <div class="tile">
              <label for="ladderPick">Ladder set</label>
              <select id="ladderPick">
                <option value="cat" selected>cat → cot → coat → coast → toast → boast</option>
                <option value="pin">pin → pan → pain → plain → plane</option>
                <option value="hop">hop → hope → hose → those</option>
                <option value="light">light → right → fright → bright</option>
              </select>
            </div>
            <div class="tile">
              <label>&nbsp;</label>
              <div class="actions">
                <button id="ladderPlay" class="btn btn-success" type="button">Play ladder</button>
                <button id="ladderStop" class="btn" type="button" disabled>Stop</button>
              </div>
            </div>
          </div>

          <div class="grid cols-3" style="gap:10px; margin-top:8px">
            <div class="tile">
              <label for="morphBase">Base word</label>
              <input id="morphBase" type="text" value="help" />
            </div>
            <div class="tile">
              <label for="morphAff">Affixes (comma‑separated)</label>
              <input id="morphAff" type="text" value="re-, un-, -ful, -less" />
            </div>
            <div class="tile">
              <label>&nbsp;</label>
              <div class="actions">
                <button id="morphPlay" class="btn btn-success" type="button">Play affixes</button>
                <button id="morphStop" class="btn" type="button" disabled>Stop</button>
              </div>
            </div>
          </div>
          <div id="vcLadderOut" class="muted" style="margin-top:6px"></div>
        </div>
      </div>

      <!-- 4) Fluency lines with pacer -->
      <div class="card" id="sec-fluency">
        <h3>4) Fluency lines</h3>
        <p class="muted">
          <strong>Why it helps:</strong> repeated, smooth reading grows automaticity without pushing
          speed.
        </p>
        <ul>
          <li>
            Pick 2–3 short lines at the right level. Re‑read for <em>smoothness</em>, not speed.
          </li>
          <li>Use a finger, ruler, or overlay as a pacer.</li>
        </ul>

        <!-- Fluency Pacer -->
        <div id="pacer" class="card" aria-labelledby="pacerH">
          <h4 id="pacerH">Fluency Pacer</h4>
          <p class="muted">Reveals words at a set pace. Aim for smooth, low‑effort reading.</p>
          <textarea id="pText" rows="4" style="width: 100%">
Today I will read in a calm, steady voice. I let each breath guide my pace. I notice patterns in words and turn them into easy steps. Small wins add up.</textarea
          >
          <div class="grid cols-3" style="gap: 10px; margin-top: 8px">
            <div class="tile">
              <label for="wpm">Words per minute</label>
              <input id="wpm" type="number" min="40" max="200" value="110" />
            </div>
            <div class="tile">
              <label>&nbsp;</label>
              <div class="actions">
                <button id="pStart" class="btn btn-success" type="button">Start</button>
                <button id="pStop" class="btn" type="button" disabled>Stop</button>
              </div>
            </div>
            <div class="tile">
              <label class="muted">Status</label>
              <div id="pStat" class="muted" aria-live="polite">Idle</div>
            </div>
          </div>
          <div
            id="pOut"
            style="
              min-height: 48px;
              margin-top: 8px;
              border: 1px solid var(--b);
              border-radius: 10px;
              padding: 10px;
            "
          ></div>
        </div>
      </div>

      <!-- 5) Visual scanning & eye‑movement -->
      <div class="card" id="sec-visual">
        <h3>5) Visual scanning &amp; eye‑movement</h3>
        <p class="muted">
          <strong>Why it helps:</strong> steady eye jumps and wider attention make lines of text
          easier to track.
        </p>
        <ul>
          <li><strong>Letter/number search:</strong> find targets in a small grid.</li>
          <li><strong>Schulte mini:</strong> tap 1→25 in order. Aim for calm accuracy.</li>
        </ul>

        <!-- Letter / Number Search -->
        <div id="searchTool" class="card" aria-labelledby="searchH">
          <h4 id="searchH">Letter / Number Search</h4>
          <div class="grid cols-3" style="gap: 10px">
            <div class="tile">
              <label for="targets">Targets (e.g., <code>a</code> or <code>a,7</code>)</label>
              <input id="targets" type="text" value="a" />
            </div>
            <div class="tile">
              <label for="size">Grid size</label>
              <select id="size">
                <option>8</option>
                <option selected>10</option>
                <option>12</option>
              </select>
            </div>
            <div class="tile">
              <label for="mix">Characters</label>
              <select id="mix">
                <option value="letters" selected>Letters</option>
                <option value="digits">Digits</option>
                <option value="both">Both</option>
              </select>
            </div>
          </div>
          <div class="actions" style="margin-top: 8px">
            <button id="sStart" class="btn btn-success" type="button">Begin</button>
            <button id="sStop" class="btn" type="button" disabled>Stop</button>
            <button id="sAgain" class="btn" type="button" disabled>Again</button>
            <span class="muted" id="sInfo" style="margin-left: 8px" aria-live="polite"
              >Score: 0 • Remaining: 0 • Time: 0s</span
            >
          </div>
          <div id="sBest" class="muted" style="margin-top: 6px"></div>
          <div id="sGrid" style="display: grid; gap: 6px; margin-top: 10px"></div>
        </div>

        <!-- Schulte Mini -->
        <div id="schulte" class="card" aria-labelledby="schulteH">
          <h4 id="schulteH">Schulte Mini (1→25)</h4>
          <div class="actions">
            <button id="schStart" class="btn btn-success" type="button">Start</button>
            <button id="schStop" class="btn" type="button" disabled>Stop</button>
            <span class="muted" id="schStats" aria-live="polite">Time: 0.0s • Best: —</span>
          </div>
          <div
            id="schGrid"
            style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-top: 10px"
          ></div>
        </div>
      </div>

      <!-- 6) RAN micro‑drill -->
      <div class="card" id="sec-ran">
        <h3>6) Rapid naming (RAN) micro‑drill</h3>
        <p class="muted">
          <strong>Why it helps:</strong> quicker naming of known items supports fluent decoding.
        </p>
        <ul>
          <li>
            Say highlighted items row by row. Keep voice relaxed; take one breath between rows.
          </li>
        </ul>

        <!-- RAN Strip -->
        <div id="ran" class="card" aria-labelledby="ranH">
          <h4 id="ranH">Rapid Naming Strip</h4>
          <div class="grid cols-3" style="gap: 10px">
            <div class="tile">
              <label for="ranSet">Symbols/letters (comma‑separated, 5 items)</label>
              <input id="ranSet" type="text" value="a, s, 3, @, k" />
            </div>
            <div class="tile">
              <label for="ranSpeed">Speed (items/sec)</label>
              <input id="ranSpeed" type="number" min="0.5" max="5" step="0.1" value="1.5" />
            </div>
            <div class="tile">
              <label for="ranRows">Rows</label>
              <select id="ranRows">
                <option>3</option>
                <option selected>4</option>
                <option>5</option>
              </select>
            </div>
          </div>
          <div class="actions" style="margin-top: 8px">
            <button id="ranGo" class="btn btn-success" type="button">Start</button>
            <button id="ranStop" class="btn" type="button" disabled>Stop</button>
            <span id="ranStat" class="muted" aria-live="polite" style="margin-left: 8px"
              >Items: 0 • Best: —</span
            >
          </div>
          <div id="ranGrid" style="display: grid; gap: 6px; margin-top: 10px"></div>
        </div>
      </div>

      <h2>Breaks &amp; regulation</h2>
      <ul>
        <li>Every 2–5 minutes, pause for 3–5 slow breaths (or one 60‑second SOS breath).</li>
        <li>End on a success—short and steady beats long and exhausting.</li>
      </ul>

      <div class="card">
        <h3>Tips</h3>
        <ul>
          <li>Celebrate <em>effort and strategy</em>, not speed.</li>
          <li>If text feels crowded, try bigger spacing or a coloured overlay.</li>
          <li>Use a ruler or finger as a pacer; keep eye jumps small and even.</li>
          <li>Pair a breath with transitions (before starting, switching tasks, or finishing).</li>
          <li>Many short sessions lead to better gains than occasional long ones.</li>
        </ul>
      </div>

      <h2>Resources (Adults)</h2>
      <div class="card">
        <ul>
          <li>
            <a
              href="https://www.twinkl.com.sg/search?q=dyslexia+resources+adult&amp;c=244&amp;r=parent&amp;fco=0&amp;n=30&amp;fa=9"
              target="_blank"
              rel="noopener"
              >Twinkl – adult dyslexia resources</a
            >
            — printable practice and how‑to guides.
          </li>
          <li>
            <a href="https://www.bdadyslexia.org.uk/advice/adults" target="_blank" rel="noopener"
              >British Dyslexia Association – Adults</a
            >
            — study, work, and daily‑life strategies.
          </li>
          <li>
            <a href="https://dyslexiaida.org/" target="_blank" rel="noopener"
              >International Dyslexia Association</a
            >
            — evidence‑informed reading information and fact sheets.
          </li>
          <li>
            <a href="https://dyslexia.yale.edu/resources/adults/" target="_blank" rel="noopener"
              >Yale Center for Dyslexia &amp; Creativity – Adults</a
            >
            — strengths‑based guidance and tools.
          </li>
          <li>
            <a href="https://www.understood.org/en/articles/dyslexia-in-adults" target="_blank" rel="noopener"
              >Understood.org – Dyslexia in adults</a
            >
            — practical tips and community stories.
          </li>
          <li>
            <a href="https://improvingliteracy.org/" target="_blank" rel="noopener"
              >National Center on Improving Literacy</a
            >
            — research‑informed literacy resources.
          </li>
          <li>
            <a href="https://readingrockets.org/" target="_blank" rel="noopener">Reading Rockets</a>
            — decoding, fluency, and practice ideas.
          </li>
          <li>
            <a href="https://www.nidcd.nih.gov/health/voice-speech-and-language" target="_blank" rel="noopener"
              >NIH / NIDCD</a
            >
            — background on speech, language, and hearing.
          </li>
          <li>
            <a href="https://www.dyslexia-scotland.org.uk/adults/" target="_blank" rel="noopener"
              >Dyslexia Scotland – Adults</a
            >
            — adult learning and workplace support.
          </li>
        </ul>

        <!-- Download (latest) -->
        <div class="actions" style="margin-top: 10px">
          <a
            class="btn btn-success"
            href="assets/dyslexia_adult_resources.pdf"
            download
            >Download: Dyslexia Adult Resources (PDF)</a
          >
        </div>

        <p class="muted" style="margin-top: 6px">
          Links open in a new tab. If any link is unavailable in your region, search the organization
          name directly.
        </p>
      </div>

      <hr />
      <p class="muted">
        © <span id="year"></span> — Educational information only; not medical advice.
      </p>
    </main>

    <!-- Lightweight modal (welcome / breaks) -->
    <div
      id="focusModal"
      style="
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        background: rgba(0,0,0,.45);
        z-index: 9999;
        padding: 16px;
      "
      aria-live="polite"
      aria-modal="true"
      role="dialog"
    >
      <div
        id="focusModalCard"
        class="card"
        style="
          max-width: 720px;
          width: min(96vw, 720px);
          box-shadow: var(--shadow-1);
        "
      >
        <h3 id="fmTitle" style="margin-top: 0">Reading Trainer</h3>
        <div id="fmBody" class="muted" style="margin-top: 6px"></div>
        <div class="actions" style="margin-top: 10px">
          <button id="fmOk" class="btn btn-success" type="button">OK</button>
          <button id="fmCancel" class="btn" type="button" style="display:none">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Pomodoro mini bar -->
    <div
      id="pomoBar"
      style="
        position: fixed;
        right: 12px;
        bottom: 12px;
        display: none;
        z-index: 9998;
        max-width: 90vw;
      "
    >
      <div class="card" style="padding: 10px 12px">
        <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap">
          <strong id="pomoLabel">Focus</strong>
          <span id="pomoTime" class="muted">00:00</span>
          <div class="actions" style="margin-left:auto">
            <button id="pomoSkip" class="btn" type="button">Skip break</button>
            <button id="pomoEnd" class="btn" type="button">End</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      /* Highlight active link, year */
      (function () {
        var path = location.pathname.split("/").pop() || "index.html";
        document.querySelectorAll("nav a").forEach(function (a) {
          if (a.getAttribute("href") === path) a.classList.add("active");
        });
        var y = document.getElementById("year");
        if (y) y.textContent = new Date().getFullYear();
      })();

      /* Reduced motion */
      var prefersReduce =
        window.matchMedia &&
        window.matchMedia("(prefers-reduced-motion: reduce)").matches;

      /* Focus helper: hide header + non-target sections while training is active */
      const Focus = (function () {
        let prevHeaderDisplay = "";
        let hidden = [];
        function hideSiblings(target) {
          const main = document.getElementById("dlxPage");
          if (!main) return;
          hidden = [];
          Array.from(main.children).forEach((node) => {
            if (node === target) return;
            const alreadyHidden = node.style && node.style.display === "none";
            if (!alreadyHidden) {
              hidden.push(node);
              node.style.display = "none";
            }
          });
        }
        function showAll() {
          hidden.forEach((n) => (n.style.display = ""));
          hidden = [];
        }
        return {
          only(el) {
            const header = document.querySelector("header.site-header");
            if (header) {
              prevHeaderDisplay = header.style.display || "";
              header.style.display = "none";
            }
            hideSiblings(el);
            try {
              el.scrollIntoView({ behavior: "smooth", block: "start" });
            } catch {}
          },
          exit() {
            const header = document.querySelector("header.site-header");
            if (header) header.style.display = prevHeaderDisplay;
            showAll();
          },
        };
      })();

      /* Minimal modal (used by Pomodoro breaks) */
      const Modal = (function () {
        const wrap = document.getElementById("focusModal");
        const title = document.getElementById("fmTitle");
        const body = document.getElementById("fmBody");
        const ok = document.getElementById("fmOk");
        const cancel = document.getElementById("fmCancel");
        let onOk = null,
          onCancel = null;

        ok.addEventListener("click", () => {
          wrap.style.display = "none";
          if (onOk) onOk();
          onOk = onCancel = null;
        });
        cancel.addEventListener("click", () => {
          wrap.style.display = "none";
          if (onCancel) onCancel();
          onOk = onCancel = null;
        });

        return {
          show(opts) {
            title.textContent = opts.title || "Reading Trainer";
            body.innerHTML = opts.html || "";
            ok.textContent = opts.okText || "OK";
            cancel.style.display = opts.cancelText ? "" : "none";
            if (opts.cancelText) cancel.textContent = opts.cancelText;
            onOk = opts.onOk || null;
            onCancel = opts.onCancel || null;
            wrap.style.display = "flex";
          },
          hide() {
            wrap.style.display = "none";
          },
        };
      })();

      /* Pomodoro helper (very light) */
      const Pomo = (function () {
        const bar = document.getElementById("pomoBar");
        const label = document.getElementById("pomoLabel");
        const time = document.getElementById("pomoTime");
        const btnSkip = document.getElementById("pomoSkip");
        const btnEnd = document.getElementById("pomoEnd");

        let mode = "work";
        let remain = 0;
        let timer = null;
        let cfg = { work: 120, break: 30 }; // seconds (≈2m / 30s)

        function fmt(s) {
          s = Math.max(0, s | 0);
          const m = String((s / 60) | 0).padStart(2, "0");
          const ss = String(s % 60).padStart(2, "0");
          return m + ":" + ss;
        }

        function tick() {
          time.textContent = fmt(remain);
          if (remain <= 0) {
            if (mode === "work") {
              // Start break
              mode = "break";
              label.textContent = "Break";
              remain = cfg.break;
              Modal.show({
                title: "Break time",
                html:
                  "<p>Rest eyes and shoulders for <strong>" +
                  cfg.break +
                  "s</strong>. Try 1 round of <em>4‑7‑8</em> breathing.</p>",
                okText: "Resume",
                onOk: () => {},
              });
            } else {
              // Return to work
              mode = "work";
              label.textContent = "Focus";
              remain = cfg.work;
            }
          } else {
            remain--;
          }
        }

        btnSkip.addEventListener("click", () => {
          if (mode === "break") {
            mode = "work";
            label.textContent = "Focus";
            remain = cfg.work;
          }
        });
        btnEnd.addEventListener("click", () => {
          Pomo.stop();
        });

        return {
          start(opts) {
            cfg = Object.assign({ work: 120, break: 30 }, opts || {});
            mode = "work";
            remain = cfg.work;
            label.textContent = "Focus";
            bar.style.display = "block";
            clearInterval(timer);
            timer = setInterval(tick, 1000);
          },
          stop() {
            bar.style.display = "none";
            clearInterval(timer);
          }
        };
      })();

      /* ------------------------------------------------------------------ */
      /* GLOBAL TTS (UK voice preference)                                    */
      /* ------------------------------------------------------------------ */
      (function () {
        const PREF_KEY = "mshare_tts_pref_v1";
        const sel = document.getElementById("ttsVoice");

        function getPref() {
          return localStorage.getItem(PREF_KEY) || "uk-auto";
        }
        function setPref(v) {
          localStorage.setItem(PREF_KEY, v);
        }

        function scoreVoice(v, want) {
          let s = 0;
          const name = (v.name || "").toLowerCase();
          const lang = (v.lang || "").toLowerCase();
          if (lang.startsWith("en-gb")) s += 100;
          if (want === "uk-f") {
            if (name.includes("female")) s += 40;
            if (name.includes("google uk english female")) s += 80;
            if (name.includes("sonia") || name.includes("libby")) s += 25;
          }
          if (want === "uk-m") {
            if (name.includes("male")) s += 40;
            if (name.includes("google uk english male")) s += 80;
            if (name.includes("ryan") || name.includes("george") || name.includes("thomas")) s += 25;
          }
          if (want === "uk-auto") {
            if (name.includes("google uk english male") || name.includes("google uk english female"))
              s += 60;
          }
          if (name.includes("google")) s += 8;
          if (name.includes("microsoft")) s += 6;
          return s;
        }

        function pick(want) {
          const list = window.speechSynthesis ? speechSynthesis.getVoices() || [] : [];
          if (!list.length) return null;
          if (want === "system") return list[0];
          let best = null;
          let bestScore = -1;
          list.forEach((v) => {
            const sc = scoreVoice(v, want);
            if (sc > bestScore) {
              best = v;
              bestScore = sc;
            }
          });
          return best || list[0];
        }

        function applyVoice(u) {
          try {
            const pref = getPref();
            const v = pick(pref);
            if (v) u.voice = v;
          } catch {}
        }

        // expose
        window.__MSHARE__ = window.__MSHARE__ || {};
        window.__MSHARE__.TTS = {
          applyVoice,
          getPref,
          setPref,
          pick,
        };

        // init select
        if (sel) {
          sel.value = getPref();
          sel.addEventListener("change", function () {
            setPref(sel.value);
            try {
              speechSynthesis.getVoices();
            } catch {}
          });
        }

        // ensure voices loaded
        if ("speechSynthesis" in window) {
          speechSynthesis.onvoiceschanged = function () {};
          try {
            speechSynthesis.getVoices();
          } catch {}
        }
      })();

      /* ------------------------------------------------------------------ */
      /* ANONYMOUS STATS (device‑local)                                      */
      /* ------------------------------------------------------------------ */
      (function () {
        const STATS_KEY = "mshare_stats_anon_v1";
        function readStats() {
          try { return JSON.parse(localStorage.getItem(STATS_KEY) || "{}"); }
          catch { return {}; }
        }
        function writeStats(obj) {
          localStorage.setItem(STATS_KEY, JSON.stringify(obj));
        }
        function addSession({ tool, seconds = 0, score = null }) {
          const s = readStats();
          s.totalSeconds = (s.totalSeconds || 0) + (seconds || 0);
          s.totalSessions = (s.totalSessions || 0) + 1;
          s.tools = s.tools || {};
          const t = s.tools[tool] || { sessions: 0, seconds: 0, bestScore: null, lastScore: null };
          t.sessions += 1;
          t.seconds += seconds || 0;
          if (score != null) {
            t.lastScore = score;
            if (t.bestScore == null || score > t.bestScore) t.bestScore = score;
          }
          s.tools[tool] = t;
          writeStats(s);
        }
        window.__MSHARE__ = window.__MSHARE__ || {};
        window.__MSHARE__.Stats = { addSession, readStats };
      })();

      /* ------------------------------------------------------------------ */
      /* beginTraining: NO AUTH, NO RESTRICTIONS                             */
      /* ------------------------------------------------------------------ */
      function beginTraining(toolId, sectionEl, startFn) {
        // Immediately start; optionally focus the section and start Pomodoro.
        Focus.only(sectionEl);
        Pomo.start({ work: 120, break: 30 });
        startFn();
      }

      /* ------------------------------------------------------------------ */
      /* TRAINING TOOLS                                                      */
      /* ------------------------------------------------------------------ */

      /* SOUND TRAINING STUDIO (audio/visual/mirror) — EXTENDED SETS + UK voice */
      (function () {
        const root = document.getElementById("svStudio");
        if (!root) return;

        const sel = document.getElementById("svSelect");
        const tiles = document.getElementById("svTiles");
        const out = document.getElementById("svOut");
        const btnAll = document.getElementById("svPractice");
        const btnStop = document.getElementById("svStop");
        const btnCam = document.getElementById("svCam");
        const btnCamOff = document.getElementById("svCamOff");
        const mirrorWrap = document.getElementById("svMirrorWrap");
        const mirror = document.getElementById("svMirror");

        let loop = null;
        let curSet = [];
        let speakOn = "speechSynthesis" in window;

        function speak(text, rate) {
          if (!speakOn) return;
          try {
            const u = new SpeechSynthesisUtterance(text);
            window.__MSHARE__?.TTS?.applyVoice(u);
            u.rate = rate || 1;
            speechSynthesis.cancel();
            speechSynthesis.speak(u);
          } catch {}
        }

        const SETS = {
          short: [
            { g: "a", ex: ["cat", "map"], cue: "Open mouth briefly: /a/." },
            { g: "e", ex: ["bed", "hem"], cue: "Relaxed mid mouth: /e/." },
            { g: "i", ex: ["sit", "milk"], cue: "Short, quick /i/." },
            { g: "o", ex: ["hot", "pond"], cue: "Round, short /o/." },
            { g: "u", ex: ["sun", "drum"], cue: "Central short /u/." },
          ],
          long: [
            { g: "a", ex: ["late", "paper"], cue: "Stretched /ā/." },
            { g: "e", ex: ["tree", "even"], cue: "Smile slightly /ē/." },
            { g: "i", ex: ["time", "pilot"], cue: "Wide then close /ī/." },
            { g: "o", ex: ["home", "open"], cue: "Round lips /ō/." },
            { g: "u", ex: ["unit", "music"], cue: "Glide /yoo/." },
          ],
          digraphs: [
            { g: "sh", ex: ["ship", "brush"], cue: "Silent lips, long air." },
            { g: "ch", ex: ["chat", "teacher"], cue: "Tiny stop + release." },
            { g: "th", ex: ["thin", "this"], cue: "Tongue on teeth; voice on/off." },
            { g: "ph", ex: ["phone", "graph"], cue: "/f/ with lips/teeth." },
            { g: "wh", ex: ["when", "whale"], cue: "Soft /w/ breath." },
            { g: "ck", ex: ["back", "packet"], cue: "/k/ after a short vowel." },
            { g: "ng", ex: ["sing", "ring"], cue: "Back‑of‑mouth nasal." },
            { g: "nk", ex: ["bank", "thank"], cue: "Nasal + /k/ cluster." },
            { g: "qu", ex: ["quick", "quiet"], cue: "/kw/ sound." },
            { g: "tch", ex: ["catch", "match"], cue: "Short vowel + /ch/." },
            { g: "dge", ex: ["bridge", "edge"], cue: "Short vowel + /j/." },
            { g: "igh", ex: ["high", "night"], cue: "Single /ī/ sound." },
            { g: "tion", ex: ["nation", "action"], cue: "Often /ʃən/." },
            { g: "sion", ex: ["vision", "decision"], cue: "Often /ʒən/ or /ʃən/." },
            { g: "ture", ex: ["picture", "nature"], cue: "Often /chər/." },
          ],
          teams: [
            { g: "ai/ay", ex: ["rain", "day"], cue: "Both say /ā/." },
            { g: "ee/ea", ex: ["see", "team"], cue: "Both say /ē/." },
            { g: "ea (head)", ex: ["head", "bread"], cue: "Sometimes /e/." },
            { g: "oa/ow", ex: ["boat", "snow"], cue: "Both say /ō/." },
            { g: "oi/oy", ex: ["coin", "boy"], cue: "Both say /oi/." },
            { g: "ou/ow", ex: ["sound", "cloud"], cue: "Common /ou/." },
            { g: "au/aw", ex: ["cause", "saw"], cue: "Common /aw/." },
            { g: "oo (long)", ex: ["moon", "food"], cue: "Long /oo/." },
            { g: "oo (short)", ex: ["book", "good"], cue: "Short /oo/." },
            { g: "ue/ui/ew", ex: ["blue", "suit"], cue: "/oo/ spellings." },
            { g: "ie/y (ī)", ex: ["pie", "try"], cue: "Long /ī/ at end." },
            { g: "eigh/ei/ey (ā)", ex: ["eight", "they"], cue: "Spellings for /ā/." },
          ],
          r: [
            { g: "ar", ex: ["car", "start"], cue: "Pull to /ar/." },
            { g: "er/ir/ur", ex: ["her", "bird"], cue: "Central /ər/." },
            { g: "or", ex: ["fork", "north"], cue: "Rounded /or/." },
            { g: "air", ex: ["chair", "hair"], cue: "R‑controlled vowel." },
            { g: "ear (er)", ex: ["learn", "earth"], cue: "Often /ər/." },
            { g: "ore", ex: ["more", "shore"], cue: "Long /or/." },
          ],
          silent: [
            { g: "kn/gn", ex: ["knee", "gnome"], cue: "Silent k/g at start." },
            { g: "wr", ex: ["write", "wrist"], cue: "Silent w at start." },
            { g: "mb", ex: ["thumb", "comb"], cue: "Silent b at end." },
            { g: "igh", ex: ["light"], cue: "Says /ī/." },
            { g: "ps- (p silent)", ex: ["psychology", "pseudonym"], cue: "Silent p at start." },
            { g: "mn- (n silent)", ex: ["mnemonic"], cue: "Silent n at start." },
            { g: "bt (b silent)", ex: ["debt", "doubt"], cue: "Silent b." },
            { g: "sc (sce/sci)", ex: ["scene", "science"], cue: "c is /s/; g is silent in “scent”." },
          ],
        };

        function buildTiles(topic) {
          tiles.innerHTML = "";
          out.textContent = speakOn
            ? "Tap a tile to hear the sound and examples."
            : "Speech not available in this browser. Read the examples aloud.";
          curSet = SETS[topic] || [];
          curSet.forEach((s) => {
            const b = document.createElement("button");
            b.className = "btn";
            b.type = "button";
            b.textContent = s.g;
            b.style.minWidth = "84px";
            b.addEventListener("click", () =>
              beginTraining("soundStudio", root, () => {
                out.innerHTML =
                  "<strong>" +
                  s.g +
                  "</strong>: " +
                  s.ex.join(", ") +
                  (s.cue ? " • <em>" + s.cue + "</em>" : "");
                if (speakOn) {
                  speak(s.g, 0.9);
                  setTimeout(() => speak(s.ex[0] || "", 1), 600);
                  setTimeout(() => speak(s.ex[1] || "", 1), 1100);
                }
                btnAll.disabled = false;
                btnStop.disabled = false;
              })
            );
            tiles.appendChild(b);
          });
          btnAll.disabled = curSet.length === 0;
          btnStop.disabled = true;
        }

        sel.addEventListener("change", () => buildTiles(sel.value));
        buildTiles(sel.value);

        btnAll.addEventListener("click", () =>
          beginTraining("soundStudio", root, () => {
            if (!("speechSynthesis" in window) || curSet.length === 0) return;
            clearInterval(loop);
            let i = 0;
            loop = setInterval(() => {
              const s = curSet[i % curSet.length];
              out.innerHTML =
                "<strong>" +
                s.g +
                "</strong>: " +
                s.ex.join(", ") +
                (s.cue ? " • <em>" + s.cue + "</em>" : "");
              speechSynthesis.cancel();
              const u1 = new SpeechSynthesisUtterance(s.g);
              window.__MSHARE__?.TTS?.applyVoice(u1);
              u1.rate = 0.9;
              const u2 = new SpeechSynthesisUtterance(s.ex[0] || "");
              window.__MSHARE__?.TTS?.applyVoice(u2);
              const u3 = new SpeechSynthesisUtterance(s.ex[1] || "");
              window.__MSHARE__?.TTS?.applyVoice(u3);
              speechSynthesis.speak(u1);
              setTimeout(() => speechSynthesis.speak(u2), 600);
              setTimeout(() => speechSynthesis.speak(u3), 1100);
              i++;
            }, prefersReduce ? 2200 : 1800);
            btnStop.disabled = false;
          })
        );

        btnStop.addEventListener("click", () => {
          clearInterval(loop);
          try {
            speechSynthesis.cancel();
          } catch {}
          btnStop.disabled = true;
          Pomo.stop();
          Focus.exit();
        });

        btnCam.addEventListener("click", () =>
          beginTraining("soundStudio", root, async () => {
            try {
              const stream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: "user" },
                audio: false,
              });
              mirror.srcObject = stream;
              mirrorWrap.style.display = "block";
              btnCamOff.disabled = false;
            } catch (e) {
              out.textContent =
                "Camera permission not granted. The mirror is optional—continue with audio practice.";
            }
          })
        );

        btnCamOff.addEventListener("click", () => {
          if (mirror.srcObject) mirror.srcObject.getTracks().forEach((t) => t.stop());
          mirror.srcObject = null;
          mirrorWrap.style.display = "none";
          btnCamOff.disabled = true;
          Pomo.stop();
          Focus.exit();
        });
      })();

      /* Pronunciation Lab (TTS quick tiles) */
      (function () {
        const root = document.getElementById("pronLab");
        if (!root) return;
        const btnWrap = root.querySelector(".grid");
        const out = document.getElementById("pronOut");
        const btnPractice = document.getElementById("pronPractice");
        const btnStop = document.getElementById("pronStop");

        const SETS = [
          { g: "a", ex: ["apple", "able"] },
          { g: "e", ex: ["egg", "even"] },
          { g: "i", ex: ["ink", "idea"] },
          { g: "o", ex: ["odd", "open"] },
          { g: "u", ex: ["up", "unit"] },
          { g: "sh", ex: ["ship", "brush"] },
          { g: "ch", ex: ["chip", "teacher"] },
          { g: "th", ex: ["thin", "this"] },
          { g: "ph", ex: ["phone", "graph"] },
          { g: "wh", ex: ["when", "whale"] },
          { g: "ai", ex: ["rain", "train"] },
          { g: "ee", ex: ["seen", "green"] },
          { g: "ea", ex: ["team", "leave"] },
          { g: "oa", ex: ["boat", "coast"] },
          { g: "ow", ex: ["slow", "grow"] },
          { g: "oi", ex: ["coin", "point"] },
          { g: "oy", ex: ["boy", "enjoy"] },
          { g: "ou", ex: ["out", "sound"] },
          { g: "aw", ex: ["saw", "dawn"] },
          { g: "au", ex: ["cause", "launch"] },
          { g: "ar", ex: ["car", "sharp"] },
          { g: "er", ex: ["her", "fern"] },
          { g: "ir", ex: ["bird", "shirt"] },
          { g: "or", ex: ["for", "storm"] },
          { g: "ur", ex: ["turn", "nurse"] },
          { g: "igh", ex: ["high", "night"] },
          { g: "tch", ex: ["catch", "match"] },
          { g: "dge", ex: ["bridge", "edge"] },
          { g: "kn", ex: ["knock", "knee"] },
          { g: "wr", ex: ["write", "wrap"] },
          { g: "mb", ex: ["thumb", "comb"] },
        ];

        let current = null,
          speakOn = "speechSynthesis" in window,
          t0 = 0;
        if (!speakOn) {
          out.textContent =
            "Speech not available in this browser. You can still tap the tiles and read the examples.";
        }

        function speak(text, rate) {
          if (!speakOn) return;
          try {
            const u = new SpeechSynthesisUtterance(text);
            window.__MSHARE__?.TTS?.applyVoice(u);
            u.rate = rate || 0.95;
            speechSynthesis.cancel();
            speechSynthesis.speak(u);
          } catch (e) {}
        }

        SETS.forEach((s) => {
          const b = document.createElement("button");
          b.className = "btn";
          b.type = "button";
          b.textContent = s.g;
          b.setAttribute("aria-label", "Speak " + s.g);
          b.style.minWidth = "72px";
          b.addEventListener("click", () =>
            beginTraining("pronLab", root, () => {
              current = s;
              out.innerHTML = "<strong>" + s.g + "</strong>: " + s.ex.join(", ");
              btnPractice.disabled = false;
              btnStop.disabled = false;
              speak(s.g, 0.8);
              setTimeout(
                () => s.ex.forEach((w, i) => setTimeout(() => speak(w, 1), 700 * (i + 1))),
                500
              );
            })
          );
          btnWrap.appendChild(b);
        });

        let loop = null,
          idx = 0;
        btnPractice.addEventListener("click", () =>
          beginTraining("pronLab", root, () => {
            if (!current) return;
            if (loop) clearInterval(loop);
            idx = 0;
            t0 = performance.now();
            loop = setInterval(() => {
              speak(current.ex[idx % current.ex.length], 1);
              idx++;
            }, 1200);
          })
        );

        btnStop.addEventListener("click", () => {
          if (loop) clearInterval(loop);
          try {
            speechSynthesis.cancel();
          } catch (e) {}
          const secs = Math.max(0, (performance.now() - t0) / 1000);
          window.__MSHARE__.Stats.addSession({
            tool: "pronLab",
            seconds: secs,
            score: idx || 0,
          });
          Pomo.stop();
          Focus.exit();
        });
      })();

      /* Letter / Number Search */
      (function () {
        const card = document.getElementById("searchTool");
        const grid = document.getElementById("sGrid");
        if (!grid || !card) return;
        const targets = document.getElementById("targets");
        const sizeSel = document.getElementById("size");
        const mix = document.getElementById("mix");
        const info = document.getElementById("sInfo");
        const start = document.getElementById("sStart");
        const stopBtn = document.getElementById("sStop");
        const again = document.getElementById("sAgain");
        const bestEl = document.getElementById("sBest");

        let targetSet = new Set(),
          remain = 0,
          score = 0,
          clicks = 0,
          startTime = 0,
          timer = null,
          running = false;

        function key() {
          return (
            "mshare_search_best_" + sizeSel.value + "_" + (targets.value || "") + "_" + mix.value
          );
        }

        function showBest() {
          const best = localStorage.getItem(key());
          bestEl.textContent = best ? "Best time (all targets found): " + best + "s" : "";
        }

        function randChar(mode) {
          const letters = "abcdefghijklmnopqrstuvwxyz";
          const digits = "0123456789";
          if (mode === "letters") return letters[Math.floor(Math.random() * letters.length)];
          if (mode === "digits") return digits[Math.floor(Math.random() * digits.length)];
          return Math.random() < 0.7 ? randChar("letters") : randChar("digits");
        }

        function refreshInfo() {
          const secs = Math.round((Date.now() - startTime) / 1000);
          info.textContent =
            "Score: " +
            score +
            " • Remaining: " +
            remain +
            " • Time: " +
            secs +
            "s • Clicks: " +
            clicks;
        }

        function finish() {
          running = false;
          clearInterval(timer);
          Array.from(grid.children).forEach((c) => (c.disabled = true));
          stopBtn.disabled = true;
          again.disabled = false;
          const secs = Math.round((Date.now() - startTime) / 1000);
          if (remain === 0) {
            const b = parseInt(localStorage.getItem(key()) || "9999", 10);
            if (secs < b) localStorage.setItem(key(), String(secs));
            showBest();
          }
          window.__MSHARE__.Stats.addSession({
            tool: "search",
            seconds: secs,
            score: score,
          });
          refreshInfo();
          Pomo.stop();
          Focus.exit();
        }

        function build() {
          beginTraining("search", card, () => {
            grid.innerHTML = "";
            score = 0;
            clicks = 0;
            startTime = Date.now();
            remain = 0;
            targetSet = new Set(
              targets.value
                .split(",")
                .map((s) => s.trim().toLowerCase())
                .filter(Boolean)
            );
            const n = parseInt(sizeSel.value, 10) || 10;
            grid.style.gridTemplateColumns = "repeat(" + n + ",1fr)";
            for (let i = 0; i < n * n; i++) {
              const ch = randChar(mix.value);
              const cell = document.createElement("button");
              cell.type = "button";
              cell.className = "btn";
              cell.textContent = ch;
              cell.style.padding = "10px";
              cell.style.fontWeight = "700";
              cell.style.minWidth = "0";
              cell.dataset.hit = targetSet.has(ch) ? "1" : "0";
              if (cell.dataset.hit === "1") remain++;
              cell.addEventListener("click", () => {
                if (!running || cell.disabled) return;
                clicks++;
                if (cell.dataset.hit === "1") {
                  score++;
                  remain--;
                  cell.style.opacity = "0.45";
                }
                cell.disabled = true;
                refreshInfo();
                if (remain === 0) finish();
              });
              grid.appendChild(cell);
            }
            again.disabled = true;
            stopBtn.disabled = false;
            running = true;
            clearInterval(timer);
            timer = setInterval(refreshInfo, 500);
            refreshInfo();
            showBest();
          });
        }

        start.addEventListener("click", build);
        again.addEventListener("click", build);
        stopBtn.addEventListener("click", finish);
      })();

      /* Schulte Mini */
      (function () {
        const card = document.getElementById("schulte");
        const grid = document.getElementById("schGrid");
        if (!grid || !card) return;
        const start = document.getElementById("schStart");
        const stop = document.getElementById("schStop");
        const stats = document.getElementById("schStats");
        const BEST_KEY = "mshare_schulte_best";
        let next = 1,
          t0 = 0,
          running = false,
          rafId = null;

        function tick() {
          if (!running) return;
          const s = ((performance.now() - t0) / 1000).toFixed(1);
          const best = localStorage.getItem(BEST_KEY) || "—";
          stats.textContent = "Time: " + s + "s • Best: " + best + " • " + (next - 1) + "/25";
          rafId = requestAnimationFrame(tick);
        }

        function shuffle(arr) {
          for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
          }
          return arr;
        }

        function stopRun(finalize) {
          if (!running) return;
          running = false;
          cancelAnimationFrame(rafId);
          Array.from(grid.children).forEach((b) => (b.disabled = true));
          let elapsed = (performance.now() - t0) / 1000;
          if (finalize) {
            const time = elapsed.toFixed(1);
            const best = parseFloat(localStorage.getItem(BEST_KEY) || "9999");
            if (next === 26 && parseFloat(time) < best) localStorage.setItem(BEST_KEY, time);
            const showBest = localStorage.getItem(BEST_KEY) || "—";
            stats.textContent =
              "Time: " + time + "s • Best: " + showBest + " • " + (next - 1) + "/25";
          }
          window.__MSHARE__.Stats.addSession({
            tool: "schulte",
            seconds: elapsed,
            score: next - 1,
          });
          Pomo.stop();
          Focus.exit();
          stop.disabled = true;
        }

        function build() {
          beginTraining("schulte", card, () => {
            grid.innerHTML = "";
            next = 1;
            running = true;
            t0 = performance.now();
            cancelAnimationFrame(rafId);
            tick();
            stop.disabled = false;
            const arr = shuffle(Array.from({ length: 25 }, (_, i) => i + 1));
            arr.forEach((n) => {
              const b = document.createElement("button");
              b.className = "btn";
              b.type = "button";
              b.textContent = n;
              b.style.padding = "14px";
              b.style.fontWeight = "800";
              b.addEventListener("click", () => {
                if (!running) return;
                if (n === next) {
                  b.style.opacity = "0.5";
                  b.disabled = true;
                  next++;
                  if (next === 26) stopRun(true);
                }
              });
              grid.appendChild(b);
            });
          });
        }

        start.addEventListener("click", build);
        stop.addEventListener("click", () => stopRun(true));
      })();

      /* RAN Strip */
      (function () {
        const root = document.getElementById("ran");
        if (!root) return;
        const ranSet = document.getElementById("ranSet");
        const speed = document.getElementById("ranSpeed");
        const rows = document.getElementById("ranRows");
        const go = document.getElementById("ranGo");
        const stop = document.getElementById("ranStop");
        const wrap = document.getElementById("ranGrid");
        const stat = document.getElementById("ranStat");
        const BEST = "mshare_ran_best_count";
        let timer = null,
          order = [],
          ptr = 0,
          count = 0,
          t0 = 0;

        function bestText() {
          const b = localStorage.getItem(BEST);
          return b ? " • Best: " + b : " • Best: —";
        }

        function build() {
          wrap.innerHTML = "";
          const items = ranSet.value
            .split(",")
            .map((s) => s.trim())
            .filter(Boolean);
          const c = 5;
          const r = parseInt(rows.value, 10) || 4;
          wrap.style.gridTemplateColumns = "repeat(" + c + ",1fr)";
          for (let i = 0; i < c * r; i++) {
            const b = document.createElement("button");
            b.className = "btn";
            b.type = "button";
            b.textContent = items[i % items.length];
            b.style.padding = "12px";
            b.style.fontWeight = "700";
            b.disabled = true;
            wrap.appendChild(b);
          }
        }

        function start() {
          beginTraining("ran", root, () => {
            build();
            const cells = Array.from(wrap.children);
            order = Array.from({ length: cells.length }, (_, i) => i).sort(
              () => Math.random() - 0.5
            );
            ptr = 0;
            count = 0;
            t0 = performance.now();
            stop.disabled = false;
            go.disabled = true;
            const interval = 1000 / parseFloat(speed.value || 1.5);
            stat.textContent = "Items: 0" + bestText();
            timer = setInterval(() => {
              cells.forEach((c) => (c.style.outline = "none"));
              const idx = order[ptr % order.length];
              const cell = cells[idx];
              cell.style.outline = "3px solid var(--b)";
              ptr++;
              count++;
              stat.textContent = "Items: " + count + bestText();
            }, prefersReduce ? interval * 1.5 : interval);
          });
        }

        function halt() {
          clearInterval(timer);
          go.disabled = false;
          stop.disabled = true;
          Array.from(wrap.children).forEach((c) => (c.style.outline = "none"));
          const b = parseInt(localStorage.getItem(BEST) || "0", 10);
          if (count > b) localStorage.setItem(BEST, String(count));
          const secs = Math.max(0, (performance.now() - t0) / 1000);
          window.__MSHARE__.Stats.addSession({
            tool: "ran",
            seconds: secs,
            score: count,
          });
          stat.textContent = "Items: " + count + bestText();
          Pomo.stop();
          Focus.exit();
        }

        go.addEventListener("click", start);
        stop.addEventListener("click", halt);
        build();
        stat.textContent = "Items: 0" + bestText();
      })();

      /* Fluency Pacer */
      (function () {
        const card = document.getElementById("pacer");
        const pText = document.getElementById("pText");
        if (!pText || !card) return;
        const wpm = document.getElementById("wpm");
        const start = document.getElementById("pStart");
        const stop = document.getElementById("pStop");
        const out = document.getElementById("pOut");
        const stat = document.getElementById("pStat");

        let words = [],
          i = 0,
          timer = null,
          t0 = 0;

        function render() {
          const shown = words.slice(0, i).join(" ");
          const rest = words.slice(i).join(" ");
          out.innerHTML = "<span>" + shown + "</span> <span class='muted'>" + rest + "</span>";
        }

        function run() {
          beginTraining("pacer", card, () => {
            words = pText.value.replace(/\s+/g, " ").trim().split(" ");
            if (!words[0]) return;
            i = 0;
            render();
            stat.textContent = "Running…";
            start.disabled = true;
            stop.disabled = false;
            t0 = performance.now();
            const interval = 60000 / Math.max(40, Math.min(200, parseInt(wpm.value || 110, 10)));
            timer = setInterval(() => {
              if (prefersReduce) {
                i = Math.min(words.length, i + 2);
              } else {
                i++;
              }
              render();
              if (i >= words.length) {
                halt();
              }
            }, interval);
          });
        }

        function halt() {
          clearInterval(timer);
          stat.textContent = "Idle";
          start.disabled = false;
          stop.disabled = true;
          const secs = Math.max(0, (performance.now() - t0) / 1000);
          window.__MSHARE__.Stats.addSession({
            tool: "pacer",
            seconds: secs,
            score: words.length || 0,
          });
          Pomo.stop();
          Focus.exit();
        }

        start.addEventListener("click", run);
        stop.addEventListener("click", halt);
      })();

      /* Voice Coach — Segment&Blend and Ladders/Morphology */
      (function () {
        /* Segment & Blend */
        const sec = document.getElementById("sec-phon");
        const out = document.getElementById("vcOut");
        const wordInp = document.getElementById("vcWord");
        const paceSel = document.getElementById("vcPace");
        const play = document.getElementById("vcPlay");
        const stop = document.getElementById("vcStop");

        if (sec && out && wordInp && paceSel && play && stop) {
          let loop = null;

          function speak(txt, rate) {
            if (!("speechSynthesis" in window)) return;
            const u = new SpeechSynthesisUtterance(txt);
            window.__MSHARE__?.TTS?.applyVoice(u);
            u.rate = rate || 0.95;
            speechSynthesis.speak(u);
          }

          function segment(word) {
            const tri = ["tch", "dge", "igh"];
            const di = [
              "sh","ch","th","ph","wh","ck","ng","nk","qu",
              "ai","ay","ee","ea","oa","ow","oi","oy","ou","au","aw",
              "ar","er","ir","or","ur","oo"
            ];
            const w = (word || "").toLowerCase().trim();
            const parts = [];
            for (let i = 0; i < w.length; ) {
              const sub3 = w.slice(i, i + 3);
              const sub2 = w.slice(i, i + 2);
              if (tri.includes(sub3)) {
                parts.push(sub3);
                i += 3;
              } else if (di.includes(sub2)) {
                parts.push(sub2);
                i += 2;
              } else {
                parts.push(w[i]);
                i += 1;
              }
            }
            return parts;
          }

          function paceMs() {
            return paceSel.value === "slow" ? 950 : paceSel.value === "fast" ? 550 : 750;
          }

          function start() {
            beginTraining("voicePhon", sec, () => {
              speechSynthesis.cancel();
              const w = wordInp.value.trim();
              if (!w) return;
              const parts = segment(w);
              out.innerHTML =
                "<strong>Segments:</strong> " + parts.join(" • ") + " &nbsp; <strong>Word:</strong> " + w;
              stop.disabled = false;
              let i = 0;
              const ms = paceMs();
              loop = setInterval(() => {
                if (i < parts.length) {
                  speak(parts[i], 0.9);
                } else if (i === parts.length) {
                  speak(w, 1);
                } else {
                  clearInterval(loop);
                }
                i++;
              }, ms);
            });
          }

          function halt() {
            clearInterval(loop);
            try {
              speechSynthesis.cancel();
            } catch {}
            stop.disabled = true;
            Pomo.stop();
            Focus.exit();
          }

          play.addEventListener("click", start);
          stop.addEventListener("click", halt);
        }

        /* Ladders & Morphology */
        const secL = document.getElementById("sec-ladders");
        const ladderPick = document.getElementById("ladderPick");
        const ladderPlay = document.getElementById("ladderPlay");
        const ladderStop = document.getElementById("ladderStop");
        const morphBase = document.getElementById("morphBase");
        const morphAff = document.getElementById("morphAff");
        const morphPlay = document.getElementById("morphPlay");
        const morphStop = document.getElementById("morphStop");
        const vcLadderOut = document.getElementById("vcLadderOut");

        if (
          secL &&
          ladderPick &&
          ladderPlay &&
          ladderStop &&
          morphBase &&
          morphAff &&
          morphPlay &&
          morphStop &&
          vcLadderOut
        ) {
          let loop1 = null;
          let loop2 = null;

          function speak(txt, rate) {
            if (!("speechSynthesis" in window)) return;
            const u = new SpeechSynthesisUtterance(txt);
            window.__MSHARE__?.TTS?.applyVoice(u);
            u.rate = rate || 1;
            speechSynthesis.speak(u);
          }

          const LADDERS = {
            cat: ["cat", "cot", "coat", "coast", "toast", "boast"],
            pin: ["pin", "pan", "pain", "plain", "plane"],
            hop: ["hop", "hope", "hose", "those"],
            light: ["light", "right", "fright", "bright"],
          };

          function playLadder() {
            beginTraining("voiceLadder", secL, () => {
              const arr = LADDERS[ladderPick.value] || [];
              if (!arr.length) return;
              vcLadderOut.textContent = arr.join(" → ");
              ladderStop.disabled = false;
              let i = 0;
              speechSynthesis.cancel();
              loop1 = setInterval(() => {
                if (i < arr.length) {
                  speak(arr[i], 1);
                  i++;
                } else {
                  clearInterval(loop1);
                }
              }, prefersReduce ? 1100 : 850);
            });
          }

          function stopLadder() {
            clearInterval(loop1);
            try {
              speechSynthesis.cancel();
            } catch {}
            ladderStop.disabled = true;
            Pomo.stop();
            Focus.exit();
          }

          function playMorph() {
            beginTraining("voiceMorph", secL, () => {
              const base = (morphBase.value || "").trim();
              const aff = (morphAff.value || "")
                .split(",")
                .map((s) => s.trim())
                .filter(Boolean);
              if (!base || !aff.length) return;
              const words = aff.map((a) =>
                a.startsWith("-")
                  ? base + a.replace(/^-/, "")
                  : a.endsWith("-")
                  ? a.replace(/-$/, "") + base
                  : a + base
              );
              vcLadderOut.textContent = [base].concat(words).join(" · ");
              morphStop.disabled = false;
              let i = -1;
              speechSynthesis.cancel();
              loop2 = setInterval(() => {
                i++;
                if (i === 0) speak("Base " + base, 1);
                else if (i <= words.length) speak(words[i - 1], 1);
                else clearInterval(loop2);
              }, prefersReduce ? 1200 : 900);
            });
          }

          function stopMorph() {
            clearInterval(loop2);
            try {
              speechSynthesis.cancel();
            } catch {}
            morphStop.disabled = true;
            Pomo.stop();
            Focus.exit();
          }

          ladderPlay.addEventListener("click", playLadder);
          ladderStop.addEventListener("click", stopLadder);
          morphPlay.addEventListener("click", playMorph);
          morphStop.addEventListener("click", stopMorph);
        }
      })();
    </script>
  </body>
</html>
