const fs = require('fs'); const path = require('path');
const H = `\n<header class="site-header">\n  <div class="container navbar">\n    <a id="brandLink" class="brand" data-href="index.html" href="index.html"><span class="logo">M</span> <span class="brand-text">M Share</span></a>\n    <nav class="main-nav" id="mainNav">\n      <a data-href="index.html">Wellbeing</a>\n      <div class="menu-group">\n        <button class="menu-toggle" aria-expanded="false">Conditions <span class="icon">▾</span></button>\n        <div class="submenu">\n          <div class="menu-label">Neurodevelopmental</div>\n          <a data-href="autism.html">Autism</a>\n          <a data-href="adhd.html">ADHD</a>\n          <a data-href="dyslexia-reading-training.html">Dyslexia</a>\n          <div class="menu-label">Mental Health</div>\n          <a data-href="anxiety.html">Anxiety</a>\n          <a data-href="depression.html">Depression</a>\n          <a data-href="stress.html">Stress</a>\n          <a data-href="sleep.html">Sleep</a>\n        </div>\n      </div>\n      <div class="menu-group">\n        <button class="menu-toggle" aria-expanded="false">Breathing &amp; Focus <span class="icon">▾</span></button>\n        <div class="submenu">\n          <div class="menu-label">Guides</div>\n          <a data-href="breath.html">Breath (how‑to)</a>\n          <a data-href="focus.html">Focus</a>\n          <a data-href="mindfulness.html">Mindfulness</a>\n          <div class="menu-label">Techniques</div>\n          <a data-href="sos-60.html">60‑second Reset</a>\n          <a data-href="box-breathing.html">Box Breathing</a>\n          <a data-href="4-7-8-breathing.html">4‑7‑8 Breathing</a>\n          <a data-href="coherent-5-5.html">Coherent 5‑5</a>\n        </div>\n      </div>\n      <div class="menu-group">\n        <button class="menu-toggle" aria-expanded="false">Toolkits <span class="icon">▾</span></button>\n        <div class="submenu">\n          <div class="menu-label">General</div>\n          <a data-href="sleep-tools.html">Sleep Tools</a>\n          <a data-href="breath-tools.html">Breath Tools</a>\n          <a data-href="mood-tools.html">Mood Tools</a>\n          <div class="menu-label">Condition‑specific</div>\n          <a data-href="adhd-tools.html">ADHD Tools</a>\n          <a data-href="autism-tools.html">Autism Tools</a>\n          <a data-href="depression-tools.html">Depression Tools</a>\n          <a data-href="anxiety-tools.html">Anxiety Tools</a>\n          <a data-href="stress-tools.html">Stress Tools</a>\n        </div>\n      </div>\n      <div class="menu-group">\n        <button class="menu-toggle" aria-expanded="false">About <span class="icon">▾</span></button>\n        <div class="submenu">\n          <a data-href="about.html">About</a>\n          <a data-href="coffee.html">Support Us</a>\n          <a data-href="contact.html">Contact</a>\n        </div>\n      </div>\n    </nav>\n    <button id="navToggle" class="nav-toggle" aria-label="Menu" aria-expanded="false" aria-controls="mainNav">☰</button>\n  </div>\n</header>\n`;
const F = `\n<footer class="footer-2025" id="footer2025">\n  <div class="wrap">\n    <div class="grid">\n      <section class="col brand">\n        <div class="brandline"><span class="logo">M</span>\n          <div><b>M Share</b><div class="muted">Quiet, practical tools for mental health and wellbeing.</div></div>\n        </div>\n        <div class="theme-controls">\n          <label>Background<input id="themeColor" type="color" value="#0f172a"></label>\n          <label>Brightness<input id="themeBrightness" type="range" min="0.85" max="1.25" step="0.01" value="1"></label>\n        </div>\n        <div class="actions" style="margin-top:8px"><a class="btn" href="#top" id="backToTop">Back to top ↑</a></div>\n      </section>\n      <section class="col">\n        <h4>Explore</h4>\n        <p><a data-href="index.html" href="index.html">Wellbeing</a> • <a data-href="breath.html" href="breath.html">Breath</a> • <a data-href="focus.html" href="focus.html">Focus</a> • <a data-href="mindfulness.html" href="mindfulness.html">Mindfulness</a> • <a data-href="about.html" href="about.html">About</a></p>\n      </section>\n      <section class="col">\n        <h4>Toolkits</h4>\n        <p><a data-href="mood-tools.html" href="mood-tools.html">Mood</a> • <a data-href="breath-tools.html" href="breath-tools.html">Breath Tools</a> • <a data-href="sleep-tools.html" href="sleep-tools.html">Sleep</a> • <a data-href="anxiety-tools.html" href="anxiety-tools.html">Anxiety</a> • <a data-href="stress-tools.html" href="stress-tools.html">Stress</a></p>\n      </section>\n      <section class="col">\n        <h4>Contact</h4>\n        <p><a data-href="contact.html" href="contact.html">Contact</a> • <a href="mailto:info.com">info.com</a></p>\n      </section>\n    </div>\n    <div class="bottom">\n      <div>© <span id="yearFooter"></span> MindPayLink · Educational information only; not medical advice.</div>\n      <div class="credit">Designed by <b>Alkhadi M Koroma</b></div>\n    </div>\n  </div>\n  <script>document.getElementById("yearFooter")&&(document.getElementById("yearFooter").textContent=(new Date).getFullYear());document.getElementById("backToTop")&&document.getElementById("backToTop").addEventListener("click",function(e){e.preventDefault();try{(document.getElementById("top")||document.body).scrollIntoView({behavior:"smooth",block:"start"})}catch{location.hash="#top"}})</script>\n</footer>\n`;
const css = ['style.css', 'assets/css/ux-fixes.css', 'assets/css/footer-2025.css', 'assets/css/header-2025.css', 'assets/css/nav-footer-uni.css', 'assets/css/responsive-fixes.css'];
const js = ['app.js', 'coach.js', 'assets/js/ux-fixes.js', 'assets/js/paylinks.js', 'assets/js/site-core.js', 'assets/js/a11y-fix.js', 'assets/js/start-fix.js', 'assets/js/nav-core.js', 'assets/js/sound-kit.js', 'assets/js/core/nav-autofix.js', 'assets/js/core/nav-core.js', 'assets/js/core/voice-coach.js', 'assets/js/core/sound-kit.js', 'assets/header/header.js', 'assets/footer/footer.js'];
function esc(s) { return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }
function ensureCss(html) { html = html.replace(/<style[^>]*id=["']breathing-responsive-fix["'][^>]*>[\s\S]*?<\/style>/gi, ''); css.forEach(h => { const r = new RegExp(`<link[^>]+href=["']${esc(h)}["'][^>]*>`, `i`); if (!r.test(html)) html = html.replace(/<\/head>/i, `<link rel="stylesheet" href="${h}" />\n</head>`) }); return html }
function replaceHeaderFooter(html) { html = html.replace(/<header[^>]*class="site-header"[\s\S]*?<\/header>/i, H); html = html.replace(/<footer[\s\S]*?<\/footer>/gi, ''); if (/<\/body>/i.test(html)) html = html.replace(/<\/body>/i, F + '\n</body>'); else html += F; return html }
function removeScripts(html) { const rm = js.concat(['assets/js/nav-2025.js', 'assets/js/core/nav-2025.js']); rm.forEach(s => { const r = new RegExp(`<script[^>]+src=["']${esc(s)}["'][^>]*>\\s*<\\/script>`, 'gi'); html = html.replace(r, '') }); return html }
function appendScripts(html) { const block = '\n' + js.map(s => `<script src="${s}"></script>`).join('\n') + '\n'; if (/<\/body>/i.test(html)) return html.replace(/<\/body>/i, block + '</body>'); return html + block }
function processOne(p) { let h = fs.readFileSync(p, 'utf8'); h = ensureCss(h); h = replaceHeaderFooter(h); h = removeScripts(h); h = appendScripts(h); fs.writeFileSync(p, h, 'utf8'); console.log('Updated', p) }
const files = ['box-breathing.html', '4-7-8-breathing.html', 'coherent-5-5.html', 'sos-60.html'];
['', 'extracted'].forEach(d => { files.forEach(f => { const p = path.join(__dirname, d, f); if (fs.existsSync(p)) processOne(p) }) });
