<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Buy me coffee ‚Ä¢ M Share</title>
  <meta name="description" content="Copy bank details and open your banking app quickly.">
  <link rel="stylesheet" href="style.css" />
  <style>
    .fields { display:grid; gap:8px; grid-template-columns: 1fr auto; }
    .field { display:grid; grid-template-columns: 1fr auto; align-items:center; gap:8px; }
    .copy-mini { border:1px solid var(--b); background:#0a1020; border-radius:10px; padding:8px 10px; cursor:pointer; }
    .copy-mini:focus-visible{ outline:2px solid var(--accent); outline-offset:2px }
    .chooser { position:fixed; inset:0; background:rgba(3,8,18,.6); display:none; place-items:center; }
    .chooser.open{ display:grid; }
    .chooser-card{ width:min(560px,96vw); background:var(--surface); border:1px solid var(--b);
      border-radius:16px; box-shadow:var(--shadow-1); padding:16px; }
    .chooser-list{ display:flex; flex-wrap:wrap; gap:8px; margin-top:8px }
    .chooser .close{ float:right; border:none; background:#0a1020; color:var(--fg); border:1px solid var(--b);
      border-radius:10px; padding:8px 10px; cursor:pointer; }
  </style>
  <link rel="stylesheet" href="assets/css/ux-fixes.css" />

  <link rel="stylesheet" href="assets/css/footer-2025.css" />
  <link rel="stylesheet" href="assets/css/header-2025.css" />
  <link rel="stylesheet" href="assets/css/nav-footer-uni.css" />
<link rel="stylesheet" href="assets/css/responsive-fixes.css"/>
<link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png" />
<link rel="apple-touch-icon" href="icons/apple-touch-icon.png" />
<link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="assets/css/nav-unified.css">
  <link rel="stylesheet" href="assets/css/voice-coach-pro.css">
  <link rel="stylesheet" href="voice-coach-fix.css">




<style id="mpl-mobile-nav-style-v4">
  /* Ensure [hidden] truly hides dropdowns in any theme */
  nav .menu[hidden], nav .submenu[hidden] { display:none !important; }

  /* Small/medium behavior only */
  @media (max-width: 1024px) {
    /* Collapsible whole nav */
    #mainNav[hidden] { display: none !important; }
    /* Group baseline */
    .nav-group, .menu-group { position: relative; }
    /* When marked open, reveal child menu block / list */
    .nav-group.open > .menu,
    .menu-group.open > .submenu { display:block; }

    /* Clickable targets (chevrons/toggles) */
    .nav-group > .menu-toggle,
    .nav-group > .chevron,
    .nav-group [data-chevron],
    .menu-group > .menu-toggle,
    .menu-group > .chevron,
    .menu-group [data-chevron] { cursor:pointer; touch-action: manipulation; }

    /* A11y focus rings on triggers */
    .nav-group > a:focus,
    .nav-group > button:focus,
    .nav-group > .menu-toggle:focus,
    .nav-group > .chevron:focus,
    .menu-group > a:focus,
    .menu-group > button:focus,
    .menu-group > .menu-toggle:focus,
    .menu-group > .chevron:focus { outline:2px solid currentColor; outline-offset:2px; }
  }

  /* Hamburger is hidden on desktop */
  @media (min-width: 1025px) { #navToggle{ display:none !important; } }
</style>

<style id="mpl-gp-cards-style-v2">
  #gp-cards { display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px; }
  @media (max-width: 640px){ #gp-cards{ grid-template-columns: 1fr; } }
  .gp-card { border:1px solid var(--gp-border,#ddd); border-radius:10px; padding:12px; background:var(--gp-bg,#fff); }
  .gp-card h4 { margin:0 0 8px; font-size:1rem; }
  .gp-examples { display:flex; flex-wrap:wrap; gap:8px; }
  .gp-examples .chip { padding:4px 8px; border-radius:999px; border:1px solid #ccc; font-size:.88rem; }
  .gp-card[aria-selected="true"] { outline:3px solid #4a90e2; }
  #gp-overlay[hidden]{ display:none; }
  #gp-overlay { position:fixed; inset:0; background:rgba(0,0,0,.5); display:flex; justify-content:center; align-items:center; z-index:2147483641; }
  #gp-overlay .gp-modal{ width:clamp(280px, 90vw, 720px); max-height:85vh; overflow:auto; background:#fff; padding:16px; border-radius:12px; box-shadow:0 10px 40px rgba(0,0,0,.35); position:relative; }
  #gp-overlay .close { position:absolute; top:14px; right:16px; }
</style>

<style id="mpl-vc-style-v2">
  .vc-draggable { position: fixed !important; z-index: 2147483642 !important; }
  .vc-drag-handle { cursor: move; user-select:none; -webkit-user-select:none; padding:6px 10px; font-weight:600; }
  .vc-pin-toggle { position: absolute; top:8px; right:8px; }
  .vc-pinned { box-shadow: 0 0 0 2px rgba(0,0,0,.1); }
</style>
</head>
<body>
<a id="top" style="position:absolute;top:0;left:0;width:0;height:0;overflow:hidden"> </a>
  <header class="site-header">
  <div class="container navbar">
    <a id="brandLink" class="brand" data-href="index.html" href="index.html"><span class="logo">M</span><span class="brand-text">M Share</span></a>
    <nav class="main-nav" id="mainNav">
  <a data-href="index.html">Wellbeing</a>
  <div class="menu-group">
    <button class="menu-toggle" aria-expanded="false">Conditions <span class="icon">‚ñæ</span></button>
    <div class="submenu">
      <div class="menu-label">Neurodevelopmental</div>
      <a data-href="autism.html">Autism</a>
      <a data-href="adhd.html">ADHD</a>
      <a data-href="dyslexia-reading-training.html">Dyslexia</a>
      <div class="menu-label">Mental Health</div>
      <a data-href="anxiety.html">Anxiety</a>
      <a data-href="depression.html">Depression</a>
      <a data-href="stress.html">Stress</a>
      <a data-href="sleep.html">Sleep</a>
    </div>
  </div>
  <div class="menu-group">
    <button class="menu-toggle" aria-expanded="false">Breathing &amp; Focus <span class="icon">‚ñæ</span></button>
    <div class="submenu">
      <div class="menu-label">Guides</div>
      <a data-href="breath.html">Breath (how‚Äëto)</a>
      <a data-href="focus.html">Focus</a>
      <a data-href="mindfulness.html">Mindfulness</a>
      <div class="menu-label">Techniques</div>
      <a data-href="sos-60.html">60‚Äësecond Reset</a>
      <a data-href="box-breathing.html">Box Breathing</a>
      <a data-href="4-7-8-breathing.html">4‚Äë7‚Äë8 Breathing</a>
      <a data-href="coherent-5-5.html">Coherent 5‚Äë5</a>
    </div>
  </div>
  <div class="menu-group">
    <button class="menu-toggle" aria-expanded="false">Toolkits <span class="icon">‚ñæ</span></button>
    <div class="submenu">
      <div class="menu-label">General</div>
      <a data-href="sleep-tools.html">Sleep Tools</a>
      <a data-href="breath-tools.html">Breath Tools</a>
      <a data-href="mood-tools.html">Mood Tools</a>
      <div class="menu-label">Condition‚Äëspecific</div>
      <a data-href="adhd-tools.html">ADHD Tools</a>
      <a data-href="autism-tools.html">Autism Tools</a>
      <a data-href="depression-tools.html">Depression Tools</a>
      <a data-href="anxiety-tools.html">Anxiety Tools</a>
      <a data-href="stress-tools.html">Stress Tools</a>
    </div>
  </div>
  <div class="menu-group">
    <button class="menu-toggle" aria-expanded="false">About <span class="icon">‚ñæ</span></button>
    <div class="submenu">
      <a data-href="about.html">About</a>
      <a data-href="coffee.html">Support Us</a>
      <a data-href="contact.html">Contact</a>
    </div>
  </div>
</nav>
    <button type="button" id="navToggle" class="nav-toggle" aria-label="Menu" aria-expanded="false" aria-controls="mainNav">‚ò∞</button>
  </div>
</header>




  <main class="container">
    <div class="card">
      <h1>Buy me a coffee ‚òï</h1>
<p class="actions"><a class="btn btn-success" target="_blank" rel="noopener" href="https://buy.stripe.com/28E4gy5j6cmD2wu3pk4Rq00">üí≥ Pay by card (Stripe)</a></p>
      <p class="muted">
        Tap <b>Copy details</b> then <b>Open bank app</b>. We try your installed app first and gracefully fall back.
      </p>

      <!-- Bank details -->
      <div class="kv-grid" style="margin-top:12px">
        <div class="kv"><div class="muted">Account name</div><div id="accName" style="font-weight:600">‚Äî</div></div>
        <div class="kv"><div class="muted">Bank</div><div id="bankName" style="font-weight:600">‚Äî</div></div>
        <div class="kv"><div class="muted">Reference</div><div id="ref" style="font-weight:600">M SHARE</div></div>
        <div class="kv"><div class="muted">Account number</div><div id="acc" style="font-weight:600">‚Äî</div></div>
        <div class="kv"><div class="muted">Sort code</div><div id="sort" style="font-weight:600">‚Äî</div></div>
        <div class="kv"><div class="muted">IBAN</div><div id="iban" style="font-weight:600">‚Äî</div></div>
      </div>

      <!-- Actions -->
      <div class="actions">
        <button type="button" class="btn" id="copyAll">üìã Copy details</button>
        <button type="button" class="btn" id="openChooser">üè¶ Open bank app</button>
        <span id="feedback" class="muted"></span>
      </div>

      <!-- Per-field copy -->
      <div class="card" style="margin-top:12px">
        <h3 style="margin-top:0">Quick copy (single fields)</h3>
        <div class="fields">
          <div class="field"><div class="muted">Name</div><div id="f_name" class="val">‚Äî</div></div>
          <button type="button" class="copy-mini" data-k="payee_full_name">Copy</button>

          <div class="field"><div class="muted">Bank</div><div id="f_bank" class="val">‚Äî</div></div>
          <button type="button" class="copy-mini" data-k="bank_name">Copy</button>

          <div class="field"><div class="muted">Account</div><div id="f_acc" class="val">‚Äî</div></div>
          <button type="button" class="copy-mini" data-k="account_number">Copy</button>

          <div class="field"><div class="muted">Sort code</div><div id="f_sort" class="val">‚Äî</div></div>
          <button type="button" class="copy-mini" data-k="sort_code">Copy</button>

          <div class="field"><div class="muted">IBAN</div><div id="f_iban" class="val">‚Äî</div></div>
          <button type="button" class="copy-mini" data-k="iban">Copy</button>
        </div>
        <p class="muted" style="margin-top:8px">On iOS 16+, allow paste if prompted.</p>
      </div>
    </div>
  </main>
<footer class="footer-2025" id="footer2025">
  <div class="wrap">
    <div class="grid">
      <section class="col brand">
        <div class="brandline"><span class="logo">M</span>
          <div><b>M Share</b><div class="muted">Quiet, practical tools for mental health and wellbeing.</div></div>
        </div>
        <div class="theme-controls">
          <label>Background<input id="themeColor" type="color" value="#0f172a"></label>
          <label>Brightness<input id="themeBrightness" type="range" min="0.85" max="1.25" step="0.01" value="1"></label>
        </div>
        <div class="actions" style="margin-top:8px"><a class="btn" href="#top" id="backToTop">Back to top ‚Üë</a></div>
      </section>
      <section class="col">
        <h4>Explore</h4>
        <p><a data-href="index.html" href="index.html">Wellbeing</a> ‚Ä¢ <a data-href="breath.html" href="breath.html">Breath</a> ‚Ä¢ <a data-href="focus.html" href="focus.html">Focus</a> ‚Ä¢ <a data-href="mindfulness.html" href="mindfulness.html">Mindfulness</a> ‚Ä¢ <a data-href="about.html" href="about.html">About</a></p>
      </section>
      <section class="col">
        <h4>Toolkits</h4>
        <p><a data-href="mood-tools.html" href="mood-tools.html">Mood</a> ‚Ä¢ <a data-href="breath-tools.html" href="breath-tools.html">Breath Tools</a> ‚Ä¢ <a data-href="sleep-tools.html" href="sleep-tools.html">Sleep</a> ‚Ä¢ <a data-href="anxiety-tools.html" href="anxiety-tools.html">Anxiety</a> ‚Ä¢ <a data-href="stress-tools.html" href="stress-tools.html">Stress</a></p>
      </section>
      <section class="col">
        <h4>Contact</h4>
        <p><a data-href="contact.html" href="contact.html">Contact</a> ‚Ä¢ <a href="mailto:info.com">info.com</a></p>
      </section>
    </div>
    <div class="bottom">
      <div>¬© <span id="yearFooter"></span> MindPayLink ¬∑ Educational information only; not medical advice.</div>
      <div class="credit">Designed by <b>Alkhadi M Koroma</b></div>
    </div>
  </div>
  <script>document.getElementById("yearFooter")&&(document.getElementById("yearFooter").textContent=(new Date).getFullYear());document.getElementById("backToTop")&&document.getElementById("backToTop").addEventListener("click",function(e){e.preventDefault();try{(document.getElementById("top")||document.body).scrollIntoView({behavior:"smooth",block:"start"})}catch{location.hash="#top"}})</script>
</footer>







  <!-- Bank chooser modal -->
  <div id="chooser" class="chooser" role="dialog" aria-modal="true" aria-labelledby="chooserTitle">
    <div class="chooser-card">
      <button type="button" class="close" id="chooserClose" aria-label="Close">‚úï</button>
      <h3 id="chooserTitle" style="margin:0 0 6px">Choose your bank</h3>
      <div class="chooser-list" id="chooserList"></div>
      <p class="muted" style="margin-top:10px">If nothing opens, open your bank app manually and paste the copied details.</p>
    </div>
  </div>

  <!-- Share sheet (existing) -->
  <div id="shareSheet" class="sheet hidden">
    <div id="shareBackdrop" style="position:absolute; inset:0;"></div>
    <div class="sheet-card" role="dialog" aria-modal="true" aria-labelledby="shareTitle">
      <div class="sheet-head"><h2 id="shareTitle" class="sheet-title">Share</h2><button type="button" id="shareClose" class="sheet-close" aria-label="Close">√ó</button></div>
      <textarea id="shareText" class="share-text" readonly title="Textarea" placeholder=" "></textarea>
      <div class="share-actions">
        <button type="button" class="btn" id="copyShare">üìã Copy</button>
        <button type="button" class="btn" id="shareNative">üîó Share‚Ä¶</button>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const { data, bankDetailsString, openAppOrStore } = window.__MSHARE__ || { data:{} };

      // --- Resolve values (with sensible defaults) ---
      const payee = data.name || data.payee_full_name || 'Alkhadi Koroma';
      const bank  = data.bank_name || data.bank || 'Santander';
      const acc   = data.acc || data.account_number || '93087283';
      const sort  = (data.sort || data.sort_code || '09-01-35');
      const iban  = data.iban || '';
      const ref   = data.ref || data.reference || 'M SHARE';

      // Fill UI
      (id=>document.getElementById(id).textContent = payee)('accName');
      (id=>document.getElementById(id).textContent = bank)('bankName');
      (id=>document.getElementById(id).textContent = ref)('ref');
      (id=>document.getElementById(id).textContent = acc)('acc');
      (id=>document.getElementById(id).textContent = sort)('sort');
      (id=>document.getElementById(id).textContent = (iban || '‚Äî'))('iban');

      document.getElementById('f_name').textContent = payee;
      document.getElementById('f_bank').textContent = bank;
      document.getElementById('f_acc').textContent  = acc;
      document.getElementById('f_sort').textContent = sort;
      document.getElementById('f_iban').textContent = iban || '‚Äî';

      // Structured payload for clipboard / bridge
      const payload = {
        payee_full_name: payee,
        bank_name: bank,
        account_number: acc,
        sort_code: sort.replace(/[^0-9]/g,'').replace(/(\d{2})(\d{2})(\d{2})/,'$1-$2-$3'),
        iban: iban || ""
      };

      function asPrettyText(p) {
        return `Payee: ${p.payee_full_name}
Bank: ${p.bank_name}
Account: ${p.account_number}
Sort code: ${p.sort_code}
IBAN: ${p.iban || '‚Äî'}
Reference: ${ref}`;
      }

      const feedback = document.getElementById('feedback');

      async function copyAll() {
        const text = asPrettyText(payload);
        try {
          if (navigator.clipboard && navigator.clipboard.write) {
            const blob = new Blob([JSON.stringify({ ...payload, reference: ref }, null, 2)], { type: 'application/json' });
            await navigator.clipboard.write([
              new ClipboardItem({
                'text/plain': new Blob([text], { type: 'text/plain' }),
                'application/json': blob
              })
            ]);
          } else {
            await navigator.clipboard.writeText(text);
          }
          feedback.textContent = 'Copied. Now open your bank app.';
          feedback.className = 'ok';
        } catch (e) {
          feedback.textContent = 'Copy failed ‚Äî long-press to copy.';
          feedback.className = 'err';
        }
      }

      async function copyField(key) {
        try {
          const map = {
            payee_full_name: payload.payee_full_name,
            bank_name: payload.bank_name,
            account_number: payload.account_number,
            sort_code: payload.sort_code,
            iban: payload.iban || ''
          };
          await navigator.clipboard.writeText(map[key] ?? '');
          feedback.textContent = 'Copied.';
          feedback.className = 'ok';
        } catch {
          feedback.textContent = 'Copy failed.';
          feedback.className = 'err';
        }
      }

      // Attach copy handlers
      document.getElementById('copyAll').addEventListener('click', copyAll);
      document.querySelectorAll('.copy-mini').forEach(b => b.addEventListener('click', () => copyField(b.dataset.k)));

      // --- Open bank app (modal chooser) ---
      const chooser     = document.getElementById('chooser');
      const chooserList = document.getElementById('chooserList');
      const banks = [
        { name:'Monzo',      scheme:'monzo://',                 androidStore:'https://play.google.com/store/apps/details?id=co.uk.getmondo', iosStore:'https://apps.apple.com/gb/app/monzo/id1058807477' },
        { name:'Starling',   scheme:'starling://',              androidStore:'https://play.google.com/store/apps/details?id=com.starlingbank.android', iosStore:'https://apps.apple.com/gb/app/starling-bank-mobile-banking/id1138470780' },
        { name:'Revolut',    scheme:'revolut://',               androidStore:'https://play.google.com/store/apps/details?id=com.revolut.revolut', iosStore:'https://apps.apple.com/gb/app/revolut/id932493382' },
        { name:'Barclays',   scheme:'barclaysmobilebanking://', androidStore:'https://play.google.com/store/apps/details?id=com.barclays.android.barclaysmobilebanking', iosStore:'https://apps.apple.com/gb/app/barclays/id433828350' },
        { name:'NatWest',    scheme:'natwest://',               androidStore:'https://play.google.com/store/apps/details?id=com.rbs.mobile.android.natwest', iosStore:'https://apps.apple.com/gb/app/natwest-mobile-banking/id310250715' },
        { name:'HSBC UK',    scheme:'hsbcukmobilebanking://',   androidStore:'https://play.google.com/store/apps/details?id=uk.co.hsbc.hsbcukmobilebanking', iosStore:'https://apps.apple.com/gb/app/hsbc-uk-mobile-banking/id1424253055' },
        { name:'Santander',  scheme:'santanderuk://',           androidStore:'https://play.google.com/store/apps/details?id=uk.co.santander.santanderUK', iosStore:'https://apps.apple.com/gb/app/santander-uk-mobile-banking/id435871685' },
        { name:'Lloyds',     scheme:'lloydsbank://',            androidStore:'https://play.google.com/store/apps/details?id=com.grppl.android.shell.CMBlloydsTSB73', iosStore:'https://apps.apple.com/gb/app/lloyds-bank-mobile-banking/id469960709' },
        { name:'Halifax',    scheme:'halifax://',               androidStore:'https://play.google.com/store/apps/details?id=com.grppl.android.shell.halifax', iosStore:'https://apps.apple.com/gb/app/halifax-mobile-banking/id310287928' },
        { name:'TSB',        scheme:'tsb://',                   androidStore:'https://play.google.com/store/apps/details?id=uk.co.tsb.mobilebank', iosStore:'https://apps.apple.com/gb/app/tsb-mobile-banking/id515307886' }
      ];

      function isAndroid() { return /Android/i.test(navigator.userAgent); }
      function openOrStore(scheme, label) {
        // Copy details for convenience every time
        navigator.clipboard.writeText(asPrettyText(payload)).catch(()=>{});
        try {
          // Use your existing helper if present
          if (typeof openAppOrStore === 'function') {
            openAppOrStore(scheme, label);
            return;
          }
        } catch {}
        // Generic attempt ‚Üí store
        const t = Date.now();
        location.href = scheme;
        setTimeout(() => {
          if (Date.now() - t < 1600) {
            const url = isAndroid()
              ? banks.find(b => b.scheme === scheme)?.androidStore
              : banks.find(b => b.scheme === scheme)?.iosStore;
            if (url) location.href = url;
          }
        }, 900);
      }

      function renderChooser() {
        chooserList.innerHTML = '';
        banks.forEach(b => {
          const a = document.createElement('a');
          a.className = 'app-btn';
          a.textContent = b.name;
          a.href = '#';
          a.addEventListener('click', (e) => {
            e.preventDefault();
            openOrStore(b.scheme, b.name);
          });
          chooserList.appendChild(a);
        });
      }
      renderChooser();

      document.getElementById('openChooser').addEventListener('click', () => {
        chooser.classList.add('open');
        copyAll(); // pre-copy so user can paste immediately
      });
      document.getElementById('chooserClose').addEventListener('click', () => chooser.classList.remove('open'));
      chooser.addEventListener('click', (e) => { if (e.target === chooser) chooser.classList.remove('open'); });
    })();
  </script>
<script src="app.js"></script>
<script src="coach.js"></script>
<script src="assets/js/ux-fixes.js"></script>
<script src="assets/js/paylinks.js"></script>
<script src="assets/js/site-core.js"></script>
<script src="assets/js/a11y-fix.js"></script>
<script src="assets/js/start-fix.js"></script><script src="assets/js/nav-core.js"></script>
<script src="assets/js/sound-kit.js"></script>
<script src="assets/js/core/nav-autofix.js"></script>
<script src="assets/js/core/nav-core.js"></script>
<script src="assets/js/core/sound-kit.js"></script>
<script src="assets/header/header.js"></script>
<script src="assets/footer/footer.js"></script>
  <script defer src="assets/js/nav-unified.js"></script>
  <script defer src="assets/js/voice-coach-pro.js"></script>
  <script defer src="voice-coach-fix.js"></script>

<script id="menu-chevron-fix">
(function(){
  var onReady = function(fn){ if (document.readyState !== 'loading') fn(); else document.addEventListener('DOMContentLoaded', fn, {once:true}); };
  onReady(function(){
    // Click or keyboard on a chevron-like control opens/closes the adjacent submenu.
    function toggleFrom(trigger, prevent){
      var btn = trigger.closest('[data-chevron], .chevron, .menu-chevron, .accordion-toggle, .has-children > button, .has-children > a, .hamburger, [aria-haspopup="menu"]');
      if(!btn) return false;

      // Find the submenu: aria-controls target, the next sibling UL/.submenu, or a nested [role="menu"].
      var submenu = null;
      var ctrl = btn.getAttribute('aria-controls');
      if (ctrl) submenu = document.getElementById(ctrl);
      if (!submenu) {
        var li = btn.closest('li, .has-children, nav, .menu, .accordion');
        if (li) submenu = li.querySelector(':scope > ul, :scope > .submenu, :scope > [role="menu"]');
      }
      if (!submenu) return false;

      if (prevent) prevent.preventDefault();

      var open = btn.getAttribute('aria-expanded') === 'true';
      btn.setAttribute('aria-expanded', String(!open));

      // Hide/show with both the hidden attribute and display style ‚Äî covers most CSS frameworks.
      if (!open) {
        submenu.removeAttribute('hidden');
        submenu.style.display = submenu.style.display || 'block';
      } else {
        submenu.setAttribute('hidden', '');
        submenu.style.display = 'none';
      }

      // If the UI uses a class toggle for transitions:
      var host = btn.closest('.has-children, li, .accordion-item');
      if (host) host.classList.toggle('open', !open);

      return true;
    }

    document.addEventListener('click', function(e){
      if (toggleFrom(e.target, e)) return;
    }, {passive:false});

    document.addEventListener('keydown', function(e){
      // Space or Enter should also toggle when the chevron has keyboard focus
      if ((e.key === 'Enter' || e.key === ' ') && toggleFrom(e.target, e)) {
        e.preventDefault();
      }
    }, {passive:false});
  });
})();
<\/script>

<script id="nav-chevrons-patch-v2">
(function(){
  var onReady = function(fn){
    if (document.readyState !== 'loading') fn();
    else document.addEventListener('DOMContentLoaded', fn, {once:true});
  };

  onReady(function(){

    // ---- Mobile hamburger (#navToggle controls #mainNav) ----
    var nav = document.getElementById('mainNav') || document.querySelector('nav.main-nav');
    var toggle = document.getElementById('navToggle') || document.querySelector('.nav-toggle');

    function openNav(){
      if (!nav || !toggle) return;
      toggle.setAttribute('aria-expanded','true');
      nav.removeAttribute('hidden');
      // If CSS hides it via display, ensure visible on mobile:
      var cs = window.getComputedStyle(nav);
      if (cs.display === 'none') nav.style.display = 'block';
      document.body.classList.add('nav-open');
    }
    function closeNav(){
      if (!nav || !toggle) return;
      toggle.setAttribute('aria-expanded','false');
      nav.setAttribute('hidden','');
      // Respect themes that rely on display toggling:
      nav.style.display = 'none';
      document.body.classList.remove('nav-open');
    }
    function isOpen(){ return toggle && toggle.getAttribute('aria-expanded') === 'true'; }

    if (toggle && nav){
      toggle.setAttribute('aria-controls', nav.id || 'mainNav');
      if (!toggle.hasAttribute('aria-expanded')) toggle.setAttribute('aria-expanded','false');

      toggle.addEventListener('click', function(e){
        e.preventDefault();
        isOpen() ? closeNav() : openNav();
      }, {passive:false});

      // Close on outside click (mobile)
      document.addEventListener('click', function(e){
        if (!isOpen()) return;
        if (e.target.closest('#mainNav, #navToggle, .nav-toggle')) return;
        closeNav();
      }, {passive:true});

      // Close on Escape
      document.addEventListener('keydown', function(e){
        if (e.key === 'Escape' && isOpen()) closeNav();
      }, {passive:true});
    }

    // ---- Chevron submenus (.menu-group -> .menu-toggle + .submenu) ----
    var groups = Array.prototype.slice.call(document.querySelectorAll('.menu-group'));
    var finePointer = window.matchMedia && window.matchMedia('(pointer:fine)').matches;

    function closeOthers(except){
      groups.forEach(function(g){
        if (g === except) return;
        var b = g.querySelector('.menu-toggle, [data-chevron]');
        var m = g.querySelector('.submenu, [role="menu"], :scope > ul');
        if (!b || !m) return;
        b.setAttribute('aria-expanded','false');
        m.setAttribute('hidden','');
        g.classList.remove('open');
      });
    }

    groups.forEach(function(g){
      var btn = g.querySelector('.menu-toggle, [data-chevron]');
      var menu = g.querySelector('.submenu, [role="menu"], :scope > ul');
      if (!btn || !menu) return;

      btn.setAttribute('aria-haspopup','menu');
      if (!btn.hasAttribute('aria-expanded')) btn.setAttribute('aria-expanded','false');
      // initial hidden state
      if (btn.getAttribute('aria-expanded') !== 'true') menu.setAttribute('hidden','');

      function open(){
        closeOthers(g);
        btn.setAttribute('aria-expanded','true');
        menu.removeAttribute('hidden');
        g.classList.add('open');
      }
      function close(){
        btn.setAttribute('aria-expanded','false');
        menu.setAttribute('hidden','');
        g.classList.remove('open');
      }
      function toggle(){
        (btn.getAttribute('aria-expanded') === 'true') ? close() : open();
      }

      // Click / tap on chevron
      btn.addEventListener('click', function(e){
        e.preventDefault();
        toggle();
      }, {passive:false});

      // Keyboard toggle
      btn.addEventListener('keydown', function(e){
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggle(); }
        if (e.key === 'Escape') { close(); btn.focus(); }
      }, {passive:false});

      // Hover/focus open (desktop only; won't fire on touch-only devices)
      if (finePointer){
        g.addEventListener('mouseenter', open, {passive:true});
        g.addEventListener('mouseleave', close, {passive:true});
        g.addEventListener('focusin', open, {passive:true});
        g.addEventListener('focusout', function(ev){
          if (!g.contains(ev.relatedTarget)) close();
        }, {passive:true});
      }
    });

    // Close open submenu on outside click (desktop)
    document.addEventListener('click', function(e){
      var hitGroup = e.target.closest('.menu-group');
      if (!hitGroup) closeOthers(null);
    }, {passive:true});

  });
})();
<\/script>

<script id="focus-overlay-dedupe-v2">
(function(){
  var onReady = function(fn){
    if (document.readyState !== 'loading') fn();
    else document.addEventListener('DOMContentLoaded', fn, {once:true});
  };
  onReady(function(){
    // Keep the visible "square" focus panel if present:
    var keep = document.querySelector('#focusModal, .focus-screen, .focus-panel, .breathing-panel');
    // Potential legacy/round visuals to remove:
    var extraSel = [
      '#vc-focus', '.vc-focus', '.breathing-circle', '.focus-circle',
      '#breathCanvas', '#voiceCoachCircle', '.circle-bg', '.legacy-breathing', '.coach-circle'
    ].join(',');

    function hide(node){ try{ node.style.display='none'; node.setAttribute('data-removed-by-fix','true'); }catch{} }

    if (keep){
      // Hide large canvases/SVGs NOT inside the keep panel (the behind layer).
      Array.prototype.slice.call(document.querySelectorAll('canvas,svg')).forEach(function(n){
        if (keep.contains(n)) return;
        var r; try{ r = n.getBoundingClientRect(); }catch(e){}
        if (r && r.width >= 180 && r.height >= 180) hide(n);
      });
      // Hide known legacy containers not in keep
      Array.prototype.slice.call(document.querySelectorAll(extraSel)).forEach(function(n){
        if (!keep.contains(n)) hide(n);
      });
    } else {
      // If no "square" panel exists, but both a ring + some other panel exist, keep the top-most by z-index and hide others
      var layers = Array.prototype.slice.call(document.querySelectorAll('#vc-focus, .vc-focus, .focus-panel, .breathing-panel, #focusModal, .focus-screen, canvas, svg'));
      if (!layers.length) return;
      // Pick the visible one with largest z-index
      var top = null, topZ = -Infinity;
      layers.forEach(function(el){
        var cs = window.getComputedStyle(el);
        if (cs.display === 'none' || cs.visibility === 'hidden' || cs.opacity === '0') return;
        var z = parseInt(cs.zIndex || '0', 10); if (isNaN(z)) z = 0;
        if (z >= topZ) { topZ = z; top = el; }
      });
      layers.forEach(function(el){ if (el !== top) hide(el); });
    }
  });
})();
<\/script>

<script id="mpl-mobile-nav-patch-v3">
(function(){
  var MQ = window.matchMedia ? window.matchMedia("(max-width: 1024px)") : {matches:true, addEventListener:function(){}};

  function onReady(fn){
    if (document.readyState !== 'loading') fn();
    else document.addEventListener('DOMContentLoaded', fn, {once:true});
  }

  function closestNavRoot() {
    return document.getElementById('mainNav')
        || document.querySelector('nav.main-nav')
        || document.querySelector('header nav')
        || document.querySelector('nav');
  }

  function setupMobileNav(){
    var nav = closestNavRoot();
    if (!nav) return;

    // Hamburger master toggle (optional; only on mobile)
    var toggle = document.getElementById('navToggle')
      || document.querySelector('.nav-toggle, .hamburger, [aria-controls="mainNav"]');

    function openNav(){
      if (!MQ.matches || !nav || !toggle) return;
      toggle.setAttribute('aria-expanded','true');
      nav.removeAttribute('hidden');
      var cs = window.getComputedStyle(nav);
      if (cs.display === 'none') nav.style.display = 'block';
      document.body.classList.add('nav-open');
    }
    function closeNav(){
      if (!nav || !toggle) return;
      toggle.setAttribute('aria-expanded','false');
      if (MQ.matches) {
        nav.setAttribute('hidden','');
        nav.style.display = 'none';
      }
      document.body.classList.remove('nav-open');
    }
    function isOpen(){ return toggle && toggle.getAttribute('aria-expanded') === 'true'; }

    if (toggle) {
      toggle.setAttribute('aria-controls', nav.id || 'mainNav');
      if (!toggle.hasAttribute('aria-expanded')) toggle.setAttribute('aria-expanded','false');
      toggle.addEventListener('click', function(e){ if (MQ.matches) { e.preventDefault(); isOpen()?closeNav():openNav(); } }, {passive:false});
      document.addEventListener('click', function(e){
        if (!MQ.matches || !isOpen()) return;
        if (e.target.closest('#mainNav, #navToggle, .nav-toggle, .hamburger')) return;
        closeNav();
      }, {passive:true});
      document.addEventListener('keydown', function(e){ if (MQ.matches && e.key === 'Escape' && isOpen()) closeNav(); }, {passive:true});
    }

    // Submenu groups (mobile only; do not touch desktop)
    function closeOthers(except) {
      if (!MQ.matches) return;
      nav.querySelectorAll('.menu-group.open').forEach(function(g){
        if (g === except) return;
        var m = g.querySelector('.submenu, [role="menu"], :scope > ul');
        if (m) m.setAttribute('hidden','');
        g.classList.remove('open');
        var t = g.querySelector('.chevron, [data-chevron], .menu-toggle, :scope > a, :scope > button');
        if (t) t.setAttribute('aria-expanded','false');
      });
    }

    Array.prototype.slice.call(nav.querySelectorAll('.menu-group')).forEach(function(g){
      var menu = g.querySelector('.submenu, [role="menu"], :scope > ul');
      if (!menu) return;

      var chevron = g.querySelector('.chevron, [data-chevron], .menu-toggle')
                  || g.querySelector(':scope > a')
                  || g.firstElementChild;

      function initMobile(){
        // Initialize collapsed state on mobile only
        if (!MQ.matches) { g.classList.remove('open'); menu.removeAttribute('hidden'); return; }
        menu.setAttribute('hidden','');
        g.classList.remove('open');
        if (chevron) {
          chevron.setAttribute('tabindex','0');
          chevron.setAttribute('aria-haspopup','menu');
          chevron.setAttribute('aria-expanded','false');

          function open(){ closeOthers(g); menu.removeAttribute('hidden'); g.classList.add('open'); chevron.setAttribute('aria-expanded','true'); }
          function close(){ menu.setAttribute('hidden',''); g.classList.remove('open'); chevron.setAttribute('aria-expanded','false'); }
          function toggle(e){ if (e) e.preventDefault(); (g.classList.contains('open') ? close : open)(); }

          chevron.addEventListener('click', toggle, {passive:false});
          chevron.addEventListener('keydown', function(e){
            if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggle(); }
            if (e.key === 'Escape') { e.preventDefault(); close(); chevron.focus(); }
          }, {passive:false});

          // Hover support where available (still gated to mobile width)
          if (window.matchMedia && window.matchMedia('(pointer:fine)').matches) {
            g.addEventListener('mouseenter', function(){ if (MQ.matches) { closeOthers(g); menu.removeAttribute('hidden'); g.classList.add('open'); chevron.setAttribute('aria-expanded','true'); } }, {passive:true});
            g.addEventListener('mouseleave', function(){ if (MQ.matches) { menu.setAttribute('hidden',''); g.classList.remove('open'); chevron.setAttribute('aria-expanded','false'); } }, {passive:true});
          }
        }
      }

      // Initialize now and on viewport changes
      initMobile();
      if (MQ.addEventListener) MQ.addEventListener('change', initMobile);
      else if (MQ.addListener) MQ.addListener(initMobile); // Safari legacy

      // Close open submenu on outside click (mobile)
      document.addEventListener('click', function(e){
        if (!MQ.matches) return;
        var hitGroup = e.target.closest('.menu-group');
        if (!hitGroup) closeOthers(null);
      }, {passive:true});
    });
  }

  onReady(setupMobileNav);
})();
<\/script>

<script id="mpl-vc-patch-v1">
(function(){
  function onReady(fn){
    if (document.readyState !== 'loading') fn();
    else document.addEventListener('DOMContentLoaded', fn, {once:true});
  }
  function findPanel(){
    return document.querySelector('#voiceCoachPanel, .voice-coach, #vcPanel, #voiceCoach, #vc-focus-panel');
  }
  function persist(key, val){ try { localStorage.setItem(key, JSON.stringify(val)); } catch(e){} }
  function restore(key){ try { var v = localStorage.getItem(key); return v? JSON.parse(v) : null; } catch(e){ return null; } }

  function makeDraggable(panel){
    if (!panel) return;
    panel.classList.add('vc-draggable');
    panel.style.inset = 'auto'; // avoid anchoring conflicts

    // Drag handle
    var handle = panel.querySelector('.vc-drag-handle');
    if (!handle) {
      handle = document.createElement('div');
      handle.className = 'vc-drag-handle';
      handle.textContent = 'Voice Coach';
      handle.setAttribute('role', 'toolbar');
      panel.insertBefore(handle, panel.firstChild);
    }

    // Pin button
    var pin = panel.querySelector('.vc-pin-toggle');
    if (!pin) {
      pin = document.createElement('button');
      pin.type = 'button';
      pin.className = 'vc-pin-toggle';
      pin.textContent = 'Pin';
      pin.setAttribute('aria-pressed','false');
      panel.appendChild(pin);
    }

    var pref = restore('mpl.vc.pref') || { pinned: false, x: 20, y: 20 };
    var dragging = false, startX=0, startY=0, origX=0, origY=0;

    function applyPos(){
      panel.style.left = (pref.x|0) + 'px';
      panel.style.top  = (pref.y|0) + 'px';
    }
    function updatePinUI(){
      if (pref.pinned) { panel.classList.add('vc-pinned'); pin.textContent = 'Unpin'; pin.setAttribute('aria-pressed','true'); }
      else { panel.classList.remove('vc-pinned'); pin.textContent = 'Pin'; pin.setAttribute('aria-pressed','false'); }
    }

    applyPos(); updatePinUI();

    pin.addEventListener('click', function(){
      pref.pinned = !pref.pinned;
      updatePinUI(); persist('mpl.vc.pref', pref);
    });

    function onDown(ev){
      if (pref.pinned) return;
      dragging = true;
      var p = ('touches' in ev && ev.touches.length) ? ev.touches[0] : ev;
      startX = p.clientX; startY = p.clientY;
      var rect = panel.getBoundingClientRect();
      origX = rect.left + window.scrollX; origY = rect.top + window.scrollY;
      ev.preventDefault();
    }
    function onMove(ev){
      if (!dragging || pref.pinned) return;
      var p = ('touches' in ev && ev.touches.length) ? ev.touches[0] : ev;
      var dx = p.clientX - startX; var dy = p.clientY - startY;
      pref.x = Math.max(0, Math.min(window.innerWidth  - (panel.offsetWidth  || 300), origX + dx));
      pref.y = Math.max(0, Math.min(window.innerHeight - (panel.offsetHeight || 200), origY + dy));
      applyPos();
    }
    function onUp(){ if (!dragging) return; dragging = false; persist('mpl.vc.pref', pref); }

    handle.addEventListener('mousedown', onDown, {passive:false});
    document.addEventListener('mousemove', onMove, {passive:false});
    document.addEventListener('mouseup', onUp, {passive:true});

    handle.addEventListener('touchstart', onDown, {passive:false});
    document.addEventListener('touchmove', onMove, {passive:false});
    document.addEventListener('touchend', onUp, {passive:true});
    document.addEventListener('touchcancel', onUp, {passive:true});
  }

  onReady(function(){
    var p = findPanel();
    if (p) makeDraggable(p);
  });
})();
<\/script>

<script id="mpl-gp-patch-v1">
(function(){
  function onReady(fn){
    if (document.readyState !== 'loading') fn();
    else document.addEventListener('DOMContentLoaded', fn, {once:true});
  }

  var DATA = {
    "Short vowels": [
      ["a /a/", ["cat","map","sad","bag","flag","hand","pan","track"]],
      ["e /e/", ["bed","hem","pen","bell","nest","tent","best","neck"]],
      ["i /i/", ["sit","milk","fish","list","swim","brick","hill","chip"]],
      ["o /o/", ["hot","pond","lock","mop","fox","rock","cob","sock"]],
      ["u /u/", ["sun","drum","duck","cup","jump","brush","luck","bus"]]
    ],
    "Long vowels": [
      ["a /ƒÅ/", ["late","paper","bake","game","snake","frame","table","gate"]],
      ["e /ƒì/", ["tree","even","these","meter","theme","delete","piece","chief"]],
      ["i /ƒ´/", ["time","pilot","smile","kite","drive","hike","prize","spider"]],
      ["o /≈ç/", ["home","open","stone","rope","nose","global","focus","hotel"]],
      ["u /yoo/", ["unit","music","unicorn","human","pupil","future","cube","uniform"]]
    ],
    "Digraphs / trigraphs": [
      ["sh", ["ship","brush","shine","wish","splash","sheep","shop","finish"]],
      ["ch", ["chat","teacher","chess","bench","kitchen","chocolate","chapter","lunch"]],
      ["th (/Œ∏/ or /√∞/)", ["thin","this","think","bath","path","father","weather","both"]],
      ["ph", ["phone","graph","photo","dolphin","alphabet","trophy","sphere","elephant"]],
      ["wh", ["when","whale","wheel","whisper","white","where","while","which"]],
      ["igh", ["high","night","sight","light","bright","flight","right","might"]],
      ["tch", ["catch","match","watch","patch","stitch","latch","witch","fetch"]],
      ["dge", ["bridge","edge","badge","hedge","judge","fudge","lodge","wedge"]]
    ],
    "Vowel teams": [
      ["ai/ay", ["rain","day","paint","mail","chain","tray","play","display"]],
      ["ee/ea", ["see","team","green","please","speed","read","beach","seat"]],
      ["oa/ow", ["boat","snow","float","soap","coach","slow","crow","window"]],
      ["oi/oy", ["coin","boy","boil","toy","point","joy","soil","enjoy"]],
      ["ou/ow", ["sound","cloud","house","loud","mouth","brown","crowd","down"]],
      ["au/aw", ["cause","saw","author","August","draw","crawl","sauce","lawn"]]
    ],
    "R‚Äëcontrolled vowels": [
      ["ar", ["car","start","park","farm","dark","sharp","large","garden"]],
      ["er/ir/ur", ["her","bird","turn","fern","first","nurse","curl","girl"]],
      ["or", ["fork","north","storm","short","horse","corn","porch","torch"]]
    ],
    "Silent letters": [
      ["kn/gn", ["knee","gnome","knife","knight","knock","knead","gnat","gnash"]],
      ["wr", ["write","wrist","wrong","wrap","wreck","wriggle","wren","wrench"]],
      ["mb", ["thumb","comb","lamb","climb","numb","tomb","bomb","crumb"]],
      ["igh", ["light","night","bright","sight","tight","high","slight","delight"]],
      ["tch", ["(pattern)","‚Äî","hatch","stitch","notch","clutch","sketch","batch"]]
    ]
  };

  function findGPSection(){
    // Prefer stable IDs if present
    var byId = document.querySelector('#gp-section, #dyslexia-gp, [data-section="dyslexia-gp"]');
    if (byId) return byId;
    // Fallback: heuristics
    var nodes = Array.prototype.slice.call(document.querySelectorAll('section,div,main,article'));
    return nodes.find(function(n){ return /Grapheme[‚Äì-]phoneme|GP mapping/i.test(n.textContent); }) || null;
  }
  function findStartButtonNear(el){
    if (!el) return null;
    var btn = el.querySelector('button, .btn, [role="button"]');
    if (btn && /start/i.test(btn.textContent)) return btn;
    // broader search within same section
    var candidates = Array.prototype.slice.call(el.querySelectorAll('button, .btn, [role="button"]'));
    return candidates.find(function(b){ return /start/i.test(b.textContent); }) || null;
  }

  function buildCards(){
    var host = document.createElement('div');
    host.id = 'gp-cards';
    Object.keys(DATA).forEach(function(groupName){
      var card = document.createElement('section');
      card.className = 'gp-card';
      card.setAttribute('tabindex','0');
      card.setAttribute('role','group');
      card.setAttribute('aria-label', groupName);

      var h = document.createElement('h4');
      h.textContent = groupName;
      card.appendChild(h);

      DATA[groupName].forEach(function(line){
        var [label, words] = line;
        var row = document.createElement('div');
        row.className = 'gp-examples';
        var tag = document.createElement('strong');
        tag.textContent = label + ' ‚Äî ';
        tag.style.marginRight = '6px';
        row.appendChild(tag);
        words.forEach(function(w){
          var chip = document.createElement('span');
          chip.className = 'chip';
          chip.textContent = w;
          row.appendChild(chip);
        });
        card.appendChild(row);
      });

      host.appendChild(card);
    });
    return host;
  }

  function ensureOverlay(){
    var ov = document.getElementById('gp-overlay');
    if (ov) return ov;
    ov = document.createElement('div');
    ov.id = 'gp-overlay';
    ov.setAttribute('hidden','');
    ov.setAttribute('role','dialog');
    ov.setAttribute('aria-modal','true');
    var modal = document.createElement('div');
    modal.className = 'gp-modal';
    var close = document.createElement('button');
    close.className = 'close';
    close.type = 'button';
    close.textContent = 'Close';
    close.addEventListener('click', function(){ ov.setAttribute('hidden',''); });
    ov.appendChild(modal);
    ov.appendChild(close);
    ov.addEventListener('click', function(e){ if (e.target === ov) ov.setAttribute('hidden',''); }, {passive:true});
    document.addEventListener('keydown', function(e){ if (e.key === 'Escape' && !ov.hasAttribute('hidden')) ov.setAttribute('hidden',''); }, {passive:true});
    document.body.appendChild(ov);
    return ov;
  }

  function run(){
    var sec = findGPSection();
    if (!sec) return;
    // Replace existing GP markup with cards (non-destructive: keep a .bak snapshot in DOM via comment)
    if (!sec.__mpl_gp_bak) { sec.__mpl_gp_bak = sec.innerHTML; }
    sec.innerHTML = '';
    var cards = buildCards();
    sec.appendChild(cards);

    // Selection UX
    var selected = null;
    cards.addEventListener('click', function(e){
      var c = e.target.closest('.gp-card');
      if (!c) return;
      Array.prototype.slice.call(cards.querySelectorAll('.gp-card')).forEach(function(x){ x.setAttribute('aria-selected','false'); });
      c.setAttribute('aria-selected','true');
      selected = c;
    }, {passive:true});
    cards.addEventListener('keydown', function(e){
      if ((e.key === 'Enter' || e.key === ' ') && e.target.classList.contains('gp-card')) {
        e.preventDefault(); e.target.click();
      }
    });

    // Hook section Start button -> focus the selected card
    var start = findStartButtonNear(sec);
    if (start) {
      var overlay = ensureOverlay();
      start.addEventListener('click', function(){
        var card = selected || cards.querySelector('.gp-card');
        if (!card) return;
        var clone = card.cloneNode(true);
        overlay.querySelector('.gp-modal').innerHTML = '';
        overlay.querySelector('.gp-modal').appendChild(clone);
        overlay.removeAttribute('hidden');
      });
    }
  }

  onReady(run);
})();
<\/script>

<script id="mpl-tts-patch-v1">
(function(){
  function onReady(fn){
    if (document.readyState !== 'loading') fn();
    else document.addEventListener('DOMContentLoaded', fn, {once:true});
  }

  function findReadingSection(){
    var byId = document.querySelector('#reading-section, [data-section="reading"], #section4');
    if (byId) return byId;
    var nodes = Array.prototype.slice.call(document.querySelectorAll('section,div,main,article'));
    return nodes.find(function(n){ return /section\s*4|reading section|Press\s*start\s*begin\s*reading/i.test(n.textContent); }) || null;
  }
  function findStartButtonWithin(el){
    if (!el) return null;
    var buttons = Array.prototype.slice.call(el.querySelectorAll('button, .btn, [role="button"]'));
    return buttons.find(function(b){ return /start/i.test(b.textContent.trim()); }) || null;
  }
  function getSelectionText(){
    var sel = window.getSelection && window.getSelection();
    if (sel && String(sel).trim()) return String(sel);
    return '';
  }
  function pickDefaultText(sectionEl){
    // Prefer an explicit container if present
    var target = sectionEl.querySelector('[data-reading-default], .reading-text, article, p') || sectionEl;
    return (target.innerText || target.textContent || '').trim();
  }

  function pickVoice(synth){
    try {
      var voices = synth.getVoices() || [];
      // Prefer natural UK/US English if available
      var preferred = [
        "Microsoft Sonia Online (Natural)",
        "Google UK English Female",
        "Microsoft Ryan Online (Natural)",
        "Google US English",
        "Microsoft Aria Online (Natural)"
      ];
      for (var i=0;i<preferred.length;i++){
        var v = voices.find(function(x){ return x.name.indexOf(preferred[i]) !== -1; });
        if (v) return v;
      }
      var enGB = voices.find(function(v){return /en-GB/i.test(v.lang);});
      if (enGB) return enGB;
      var en = voices.find(function(v){return /en/i.test(v.lang);});
      return en || voices[0] || null;
    } catch(e){ return null; }
  }

  function run(){
    if (!('speechSynthesis' in window) || !('SpeechSynthesisUtterance' in window)) return;
    var synth = window.speechSynthesis;
    var sec = findReadingSection();
    if (!sec) return;
    var startBtn = findStartButtonWithin(sec);
    if (!startBtn) return;

    var speaking = false, currentUtterance = null;

    function speak(text){
      if (!text) return;
      if (synth.speaking) synth.cancel();
      var u = new SpeechSynthesisUtterance(text);
      var v = pickVoice(synth);
      if (v) u.voice = v;
      u.rate = 0.95; u.pitch = 1.0; u.volume = 1.0;
      u.onend = function(){ speaking = false; startBtn.textContent = 'Start'; };
      u.onerror = function(){ speaking = false; startBtn.textContent = 'Start'; };
      speaking = true;
      startBtn.textContent = 'Stop';
      synth.speak(u);
      currentUtterance = u;
    }

    startBtn.addEventListener('click', function(){
      if (speaking) {
        synth.cancel();
        speaking = false;
        startBtn.textContent = 'Start';
        return;
      }
      var chosen = getSelectionText();
      if (!chosen) chosen = pickDefaultText(sec);
      speak(chosen);
    });
  }

  onReady(run);
})();
<\/script>

<script id="mpl-focus-dedupe-v3">
(function(){
  function onReady(fn){
    if (document.readyState !== 'loading') fn();
    else document.addEventListener('DOMContentLoaded', fn, {once:true});
  }
  function hide(node){ if (!node) return; node.style.display='none'; node.setAttribute('data-removed-by-fix','true'); }
  function run(){
    // Keep gp overlay; remove duplicate/custom ones if both present
    var keep = document.getElementById('gp-overlay') || document.querySelector('#focusModal, .focus-screen');
    var layers = Array.prototype.slice.call(document.querySelectorAll('#focusModal, .focus-screen, .focus-overlay, #vc-focus, .vc-focus'));
    if (!layers.length) return;
    if (!keep) {
      // Choose topmost visible as keep
      var top = null, z = -Infinity;
      layers.forEach(function(el){
        var cs = window.getComputedStyle(el);
        if (cs.display === 'none' || cs.visibility === 'hidden' || cs.opacity === '0') return;
        var zi = parseInt(cs.zIndex||'0',10); if (isNaN(zi)) zi = 0;
        if (zi >= z) { z = zi; top = el; }
      });
      keep = top;
    }
    layers.forEach(function(el){ if (el !== keep) hide(el); });
  }
  onReady(run);
})();
<\/script>

<script id="mpl-mobile-nav-patch-v4">
(function(){
  var MQ = window.matchMedia ? window.matchMedia('(max-width: 1024px)') : {matches:true, addEventListener:function(){}};

  function onReady(fn){
    if (document.readyState !== 'loading') fn();
    else document.addEventListener('DOMContentLoaded', fn, {once:true});
  }

  function findNav(){
    return document.getElementById('mainNav')
        || document.querySelector('nav.main-nav')
        || document.querySelector('header nav')
        || document.querySelector('nav');
  }

  function setup(){
    var nav = findNav();
    if (!nav) return;

    // Hamburger toggle for entire nav (mobile only)
    var toggle = document.getElementById('navToggle')
      || document.querySelector('.nav-toggle, .hamburger, [aria-controls="mainNav"]');

    function openNav(){
      if (!MQ.matches || !nav || !toggle) return;
      toggle.setAttribute('aria-expanded','true');
      nav.removeAttribute('hidden');
      var cs = window.getComputedStyle(nav);
      if (cs.display === 'none') nav.style.display = 'block';
      document.body.classList.add('nav-open');
    }
    function closeNav(){
      if (!nav || !toggle) return;
      toggle.setAttribute('aria-expanded','false');
      if (MQ.matches) {
        nav.setAttribute('hidden','');
        nav.style.display = 'none';
      }
      document.body.classList.remove('nav-open');
    }
    function isOpen(){ return toggle && toggle.getAttribute('aria-expanded') === 'true'; }

    if (toggle) {
      toggle.setAttribute('aria-controls', nav.id || 'mainNav');
      if (!toggle.hasAttribute('aria-expanded')) toggle.setAttribute('aria-expanded','false');
      toggle.addEventListener('click', function(e){
        if (!MQ.matches) return;
        e.preventDefault();
        isOpen() ? closeNav() : openNav();
      }, {passive:false});
      // Close nav on outside click
      document.addEventListener('click', function(e){
        if (!MQ.matches || !isOpen()) return;
        if (e.target.closest('#mainNav, #navToggle, .nav-toggle, .hamburger')) return;
        closeNav();
      }, {passive:true});
      // Close nav on Escape key
      document.addEventListener('keydown', function(e){
        if (MQ.matches && e.key === 'Escape' && isOpen()) closeNav();
      }, {passive:true});
    }

    // Submenu groups toggling
    function closeOthers(except){
      if (!MQ.matches) return;
      nav.querySelectorAll('.menu-group.open').forEach(function(g){
        if (g === except) return;
        var m = g.querySelector('.submenu, [role="menu"], :scope > ul');
        if (m) m.setAttribute('hidden','');
        g.classList.remove('open');
        var c = g.querySelector('.chevron, [data-chevron], .menu-toggle, :scope > a, :scope > button');
        if (c) c.setAttribute('aria-expanded','false');
      });
    }

    Array.prototype.slice.call(nav.querySelectorAll('.menu-group')).forEach(function(group){
      var menu = group.querySelector('.submenu, [role="menu"], :scope > ul');
      if (!menu) return;
      var toggleEl = group.querySelector('.chevron, [data-chevron], .menu-toggle')
                    || group.querySelector(':scope > a')
                    || group.firstElementChild;
      function initState(){
        if (!MQ.matches) {
          // On desktop, menus are always visible; clear attributes
          menu.removeAttribute('hidden');
          group.classList.remove('open');
          if (toggleEl) toggleEl.setAttribute('aria-expanded','false');
          return;
        }
        menu.setAttribute('hidden','');
        group.classList.remove('open');
        if (toggleEl) {
          toggleEl.setAttribute('tabindex','0');
          toggleEl.setAttribute('aria-haspopup','menu');
          toggleEl.setAttribute('aria-expanded','false');
        }
      }
      function open(){ closeOthers(group); menu.removeAttribute('hidden'); group.classList.add('open'); if (toggleEl) toggleEl.setAttribute('aria-expanded','true'); }
      function close(){ menu.setAttribute('hidden',''); group.classList.remove('open'); if (toggleEl) toggleEl.setAttribute('aria-expanded','false'); }
      function toggle(e){ if (e) e.preventDefault(); group.classList.contains('open') ? close() : open(); }

      // Initialize now and on viewport changes
      initState();
      if (MQ.addEventListener) MQ.addEventListener('change', initState);
      else if (MQ.addListener) MQ.addListener(initState);

      // Click/tap support on mobile
      if (toggleEl) {
        toggleEl.addEventListener('click', function(e){ if (!MQ.matches) return; toggle(e); }, {passive:false});
        toggleEl.addEventListener('keydown', function(e){
          if (!MQ.matches) return;
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggle(e); }
          if (e.key === 'Escape') { e.preventDefault(); close(); toggleEl.focus(); }
        }, {passive:false});
      }
      // Hover/focus for desktop (pointer:fine only)
      if (window.matchMedia && window.matchMedia('(pointer:fine)').matches) {
        group.addEventListener('mouseenter', function(){ if (!MQ.matches) open(); }, {passive:true});
        group.addEventListener('mouseleave', function(){ if (!MQ.matches) close(); }, {passive:true});
        group.addEventListener('focusin',   function(){ if (!MQ.matches) open(); }, {passive:true});
        group.addEventListener('focusout',  function(ev){ if (MQ.matches) return; if (!group.contains(ev.relatedTarget)) close(); }, {passive:true});
      }
    });

    // Close open submenu when clicking outside (mobile only)
    document.addEventListener('click', function(e){
      if (!MQ.matches) return;
      var hit = e.target.closest('.menu-group');
      if (!hit) closeOthers(null);
    }, {passive:true});
  }
  onReady(setup);
})();
<\/script>

<script id="mpl-vc-patch-v2">
(function(){
  function onReady(fn){
    if (document.readyState !== 'loading') fn();
    else document.addEventListener('DOMContentLoaded', fn, {once:true});
  }
  function findPanel(){
    return document.querySelector('#voiceCoachPanel, .voice-coach, #vcPanel, #voiceCoach, #vc-focus-panel');
  }
  function persist(key, val){ try { localStorage.setItem(key, JSON.stringify(val)); } catch(e){} }
  function restore(key){ try { var v = localStorage.getItem(key); return v ? JSON.parse(v) : null; } catch(e){ return null; } }
  function makeDraggable(panel){
    if (!panel) return;
    panel.classList.add('vc-draggable');
    panel.style.inset = 'auto';
    var handle = panel.querySelector('.vc-drag-handle');
    if (!handle) {
      handle = document.createElement('div');
      handle.className = 'vc-drag-handle';
      handle.textContent = 'Voice Coach';
      handle.setAttribute('role','toolbar');
      panel.insertBefore(handle, panel.firstChild);
    }
    var pin = panel.querySelector('.vc-pin-toggle');
    if (!pin) {
      pin = document.createElement('button');
      pin.type = 'button';
      pin.className = 'vc-pin-toggle';
      pin.textContent = 'Pin';
      pin.setAttribute('aria-pressed','false');
      panel.appendChild(pin);
    }
    var pref = restore('mpl.vc.pref') || { pinned: false, x: 20, y: 20 };
    var dragging = false, startX=0, startY=0, origX=0, origY=0;
    function applyPos(){ panel.style.left = (pref.x|0) + 'px'; panel.style.top  = (pref.y|0) + 'px'; }
    function updatePinUI(){
      if (pref.pinned) { panel.classList.add('vc-pinned'); pin.textContent = 'Unpin'; pin.setAttribute('aria-pressed','true'); }
      else { panel.classList.remove('vc-pinned'); pin.textContent = 'Pin'; pin.setAttribute('aria-pressed','false'); }
    }
    applyPos(); updatePinUI();
    pin.addEventListener('click', function(){ pref.pinned = !pref.pinned; updatePinUI(); persist('mpl.vc.pref', pref); });
    function onDown(ev){ if (pref.pinned) return; dragging = true; var p = ('touches' in ev && ev.touches.length) ? ev.touches[0] : ev; startX = p.clientX; startY = p.clientY; var rect = panel.getBoundingClientRect(); origX = rect.left + window.scrollX; origY = rect.top + window.scrollY; ev.preventDefault(); }
    function onMove(ev){ if (!dragging || pref.pinned) return; var p = ('touches' in ev && ev.touches.length) ? ev.touches[0] : ev; var dx = p.clientX - startX; var dy = p.clientY - startY; pref.x = Math.max(0, Math.min(window.innerWidth  - (panel.offsetWidth  || 300), origX + dx)); pref.y = Math.max(0, Math.min(window.innerHeight - (panel.offsetHeight || 200), origY + dy)); applyPos(); }
    function onUp(){ if (!dragging) return; dragging = false; persist('mpl.vc.pref', pref); }
    handle.addEventListener('mousedown', onDown, {passive:false});
    document.addEventListener('mousemove', onMove, {passive:false});
    document.addEventListener('mouseup', onUp, {passive:true});
    handle.addEventListener('touchstart', onDown, {passive:false});
    document.addEventListener('touchmove', onMove, {passive:false});
    document.addEventListener('touchend', onUp, {passive:true});
    document.addEventListener('touchcancel', onUp, {passive:true});
  }
  onReady(function(){ var p = findPanel(); if (p) makeDraggable(p); });
})();
<\/script>

<script id="mpl-gp-patch-v2">
(function(){
  function onReady(fn){ if (document.readyState !== 'loading') fn(); else document.addEventListener('DOMContentLoaded', fn, {once:true}); }
  // Data object containing six categories and eight examples per line (two originals + six new)
  var DATA = {
    "Short vowels": [
      ["a /a/", ["cat","map","sad","bag","flag","hand","pan","track"]],
      ["e /e/", ["bed","hem","pen","bell","nest","tent","best","neck"]],
      ["i /i/", ["sit","milk","fish","list","swim","brick","hill","chip"]],
      ["o /o/", ["hot","pond","lock","mop","fox","rock","cob","sock"]],
      ["u /u/", ["sun","drum","duck","cup","jump","brush","luck","bus"]]
    ],
    "Long vowels": [
      ["a /ƒÅ/", ["late","paper","bake","game","snake","frame","table","gate"]],
      ["e /ƒì/", ["tree","even","these","meter","theme","delete","piece","chief"]],
      ["i /ƒ´/", ["time","pilot","smile","kite","drive","hike","prize","spider"]],
      ["o /≈ç/", ["home","open","stone","rope","nose","global","focus","hotel"]],
      ["u /yoo/", ["unit","music","unicorn","human","pupil","future","cube","uniform"]]
    ],
    "Digraphs / trigraphs": [
      ["sh", ["ship","brush","shine","wish","splash","sheep","shop","finish"]],
      ["ch", ["chat","teacher","chess","bench","kitchen","chocolate","chapter","lunch"]],
      ["th (/Œ∏/ or /√∞/)", ["thin","this","think","bath","path","father","weather","both"]],
      ["ph", ["phone","graph","photo","dolphin","alphabet","trophy","sphere","elephant"]],
      ["wh", ["when","whale","wheel","whisper","white","where","while","which"]],
      ["igh", ["high","night","sight","light","bright","flight","right","might"]],
      ["tch", ["catch","match","watch","patch","stitch","latch","witch","fetch"]],
      ["dge", ["bridge","edge","badge","hedge","judge","fudge","lodge","wedge"]]
    ],
    "Vowel teams": [
      ["ai/ay", ["rain","day","paint","mail","chain","tray","play","display"]],
      ["ee/ea", ["see","team","green","please","speed","read","beach","seat"]],
      ["oa/ow", ["boat","snow","float","soap","coach","slow","crow","window"]],
      ["oi/oy", ["coin","boy","boil","toy","point","joy","soil","enjoy"]],
      ["ou/ow", ["sound","cloud","house","loud","mouth","brown","crowd","down"]],
      ["au/aw", ["cause","saw","author","August","draw","crawl","sauce","lawn"]]
    ],
    "R‚Äëcontrolled vowels": [
      ["ar", ["car","start","park","farm","dark","sharp","large","garden"]],
      ["er/ir/ur", ["her","bird","turn","fern","first","nurse","curl","girl"]],
      ["or", ["fork","north","storm","short","horse","corn","porch","torch"]]
    ],
    "Silent letters": [
      ["kn/gn", ["knee","gnome","knife","knight","knock","knead","gnat","gnash"]],
      ["wr", ["write","wrist","wrong","wrap","wreck","wriggle","wren","wrench"]],
      ["mb", ["thumb","comb","lamb","climb","numb","tomb","bomb","crumb"]],
      ["igh", ["light","night","bright","sight","tight","high","slight","delight"]],
      ["tch", ["(pattern)", "‚Äî", "hatch","stitch","notch","clutch","sketch","batch"]]
    ]
  };
  // Attempt to locate the GP section using stable IDs or heuristics
  function findGPSection(){
    var byId = document.querySelector('#gp-section, #dyslexia-gp, [data-section="dyslexia-gp"]');
    if (byId) return byId;
    var nodes = Array.prototype.slice.call(document.querySelectorAll('section,div,main,article'));
    return nodes.find(function(n){ return /Grapheme[‚Äì-]phoneme|GP mapping/i.test(n.textContent); }) || null;
  }
  function findStartButtonNear(el){
    if (!el) return null;
    var btn = el.querySelector('button, .btn, [role="button"]');
    if (btn && /start/i.test(btn.textContent)) return btn;
    var candidates = Array.prototype.slice.call(el.querySelectorAll('button, .btn, [role="button"]'));
    return candidates.find(function(b){ return /start/i.test(b.textContent); }) || null;
  }
  function buildCards(){
    var host = document.createElement('div');
    host.id = 'gp-cards';
    Object.keys(DATA).forEach(function(name){
      var card = document.createElement('section');
      card.className = 'gp-card';
      card.setAttribute('tabindex','0');
      card.setAttribute('role','group');
      card.setAttribute('aria-label', name);
      var h = document.createElement('h4');
      h.textContent = name;
      card.appendChild(h);
      DATA[name].forEach(function(item){
        var label = item[0];
        var words = item[1];
        var row = document.createElement('div');
        row.className = 'gp-examples';
        var tag = document.createElement('strong');
        tag.textContent = label + ' ‚Äî ';
        tag.style.marginRight = '6px';
        row.appendChild(tag);
        words.forEach(function(w){
          var chip = document.createElement('span');
          chip.className = 'chip';
          chip.textContent = w;
          row.appendChild(chip);
        });
        card.appendChild(row);
      });
      host.appendChild(card);
    });
    return host;
  }
  function ensureOverlay(){
    var ov = document.getElementById('gp-overlay');
    if (ov) return ov;
    ov = document.createElement('div');
    ov.id = 'gp-overlay';
    ov.setAttribute('hidden','');
    ov.setAttribute('role','dialog');
    ov.setAttribute('aria-modal','true');
    var modal = document.createElement('div');
    modal.className = 'gp-modal';
    var close = document.createElement('button');
    close.className = 'close';
    close.type = 'button';
    close.textContent = 'Close';
    close.addEventListener('click', function(){ ov.setAttribute('hidden',''); });
    ov.appendChild(modal);
    ov.appendChild(close);
    ov.addEventListener('click', function(e){ if (e.target === ov) ov.setAttribute('hidden',''); }, {passive:true});
    document.addEventListener('keydown', function(e){ if (e.key === 'Escape' && !ov.hasAttribute('hidden')) ov.setAttribute('hidden',''); }, {passive:true});
    document.body.appendChild(ov);
    return ov;
  }
  function run(){
    var sec = findGPSection();
    if (!sec) return;
    // Preserve original content if not already stored
    if (!sec.__mpl_gp_bak) sec.__mpl_gp_bak = sec.innerHTML;
    // Replace section content with cards
    sec.innerHTML = '';
    var cards = buildCards();
    sec.appendChild(cards);
    // Selection handling
    var selected = null;
    cards.addEventListener('click', function(e){ var c = e.target.closest('.gp-card'); if (!c) return; Array.prototype.slice.call(cards.querySelectorAll('.gp-card')).forEach(function(x){ x.setAttribute('aria-selected','false'); }); c.setAttribute('aria-selected','true'); selected = c; }, {passive:true});
    cards.addEventListener('keydown', function(e){ if ((e.key === 'Enter' || e.key === ' ') && e.target.classList.contains('gp-card')) { e.preventDefault(); e.target.click(); } });
    // Hook Start button to show overlay
    var startBtn = findStartButtonNear(sec);
    if (startBtn) {
      var overlay = ensureOverlay();
      startBtn.addEventListener('click', function(){ var card = selected || cards.querySelector('.gp-card'); if (!card) return; var clone = card.cloneNode(true); overlay.querySelector('.gp-modal').innerHTML = ''; overlay.querySelector('.gp-modal').appendChild(clone); overlay.removeAttribute('hidden'); });
    }
  }
  onReady(run);
})();
<\/script>

<script id="mpl-tts-patch-v2">
(function(){
  function onReady(fn){ if (document.readyState !== 'loading') fn(); else document.addEventListener('DOMContentLoaded', fn, {once:true}); }
  function findReadingSection(){ var byId = document.querySelector('#reading-section, [data-section="reading"], #section4'); if (byId) return byId; var nodes = Array.prototype.slice.call(document.querySelectorAll('section,div,main,article')); return nodes.find(function(n){ return /section\s*4|reading section|Press\s*start\s*begin\s*reading/i.test(n.textContent); }) || null; }
  function findStartButtonWithin(el){ if (!el) return null; var btns = Array.prototype.slice.call(el.querySelectorAll('button, .btn, [role="button"]')); return btns.find(function(b){ return /start/i.test((b.textContent||'').trim()); }) || null; }
  function getSelectionText(){ var sel = window.getSelection && window.getSelection(); if (sel && String(sel).trim()) return String(sel); return ''; }
  function pickDefaultText(sectionEl){ var target = sectionEl.querySelector('[data-reading-default], .reading-text, article, p') || sectionEl; return (target.innerText || target.textContent || '').trim(); }
  function pickVoice(synth){ try { var voices = synth.getVoices() || []; var preferred = [ 'Microsoft Sonia Online (Natural)', 'Google UK English Female', 'Microsoft Ryan Online (Natural)', 'Google US English', 'Microsoft Aria Online (Natural)' ]; for (var i=0; i<preferred.length; i++){ var v = voices.find(function(x){ return x.name.indexOf(preferred[i]) !== -1; }); if (v) return v; } var enGB = voices.find(function(v){ return /en-GB/i.test(v.lang); }); if (enGB) return enGB; var en = voices.find(function(v){ return /en/i.test(v.lang); }); return en || voices[0] || null; } catch(e){ return null; } }
  function run(){ if (!('speechSynthesis' in window) || !('SpeechSynthesisUtterance' in window)) return; var synth = window.speechSynthesis; var sec = findReadingSection(); if (!sec) return; var startBtn = findStartButtonWithin(sec); if (!startBtn) return; var speaking = false; var currentUtterance = null; function speak(text){ if (!text) return; if (synth.speaking) synth.cancel(); var u = new SpeechSynthesisUtterance(text); var v = pickVoice(synth); if (v) u.voice = v; u.rate = 0.95; u.pitch = 1.0; u.volume = 1.0; u.onend = function(){ speaking = false; startBtn.textContent = 'Start'; }; u.onerror = function(){ speaking = false; startBtn.textContent = 'Start'; }; speaking = true; startBtn.textContent = 'Stop'; synth.speak(u); currentUtterance = u; }
    startBtn.addEventListener('click', function(){ if (speaking){ synth.cancel(); speaking = false; startBtn.textContent = 'Start'; return; } var chosen = getSelectionText(); if (!chosen) chosen = pickDefaultText(sec); speak(chosen); }); }
  onReady(run);
})();
<\/script>

<script id="mpl-focus-dedupe-v4">
(function(){
  function onReady(fn){ if (document.readyState !== 'loading') fn(); else document.addEventListener('DOMContentLoaded', fn, {once:true}); }
  function hide(node){ if (!node) return; node.style.display='none'; node.setAttribute('data-removed-by-fix','true'); }
  function run(){
    // Keep GP overlay if present; otherwise choose topmost focus layer
    var keep = document.getElementById('gp-overlay') || document.querySelector('#focusModal, .focus-screen');
    var layers = Array.prototype.slice.call(document.querySelectorAll('#focusModal, .focus-screen, .focus-overlay, #vc-focus, .vc-focus'));
    if (!layers.length) return;
    if (!keep) {
      var top = null, z = -Infinity;
      layers.forEach(function(el){ var cs = window.getComputedStyle(el); if (cs.display === 'none' || cs.visibility === 'hidden' || cs.opacity === '0') return; var zi = parseInt(cs.zIndex || '0',10); if (isNaN(zi)) zi = 0; if (zi >= z) { z = zi; top = el; } });
      keep = top;
    }
    layers.forEach(function(el){ if (el !== keep) hide(el); });
  }
  onReady(run);
})();
<\/script>
</body>
</html>