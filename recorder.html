<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Voice Pack Recorder • M Share</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;max-width:780px;margin:40px auto;padding:0 16px}
    h1{font-size:22px} .row{display:flex;gap:8px;align-items:center;margin:10px 0}
    button{padding:8px 12px;border:1px solid #ddd;border-radius:8px;background:#fff;cursor:pointer}
    .muted{color:#666}
    audio{display:block;margin-top:6px;width:100%}
    .grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-top:12px}
    .card{border:1px solid #e5e5e5;border-radius:12px;padding:12px}
    .name{font-weight:600}
  </style>
</head>
<body>
  <h1>Voice Pack Recorder</h1>
  <p class="muted">Record “Inhale / Hold / Exhale” prompts. Save, then convert to MP3 with ffmpeg.</p>
  <div class="grid">
    <div class="card" data-key="inhale"><div class="name">Inhale</div>
      <div class="row"><button class="rec">● Record</button><button class="stop" disabled>■ Stop</button><button class="save" disabled>⬇ Save</button></div>
      <audio controls></audio>
    </div>
    <div class="card" data-key="hold"><div class="name">Hold</div>
      <div class="row"><button class="rec">● Record</button><button class="stop" disabled>■ Stop</button><button class="save" disabled>⬇ Save</button></div>
      <audio controls></audio>
    </div>
    <div class="card" data-key="exhale"><div class="name">Exhale</div>
      <div class="row"><button class="rec">● Record</button><button class="stop" disabled>■ Stop</button><button class="save" disabled>⬇ Save</button></div>
      <audio controls></audio>
    </div>
  </div>
<script>
let stream = null, mr = null, chunks = [];
document.querySelectorAll('.card').forEach(card => {
  const rec = card.querySelector('.rec');
  const stop = card.querySelector('.stop');
  const save = card.querySelector('.save');
  const audio = card.querySelector('audio');
  const key = card.getAttribute('data-key');
  rec.addEventListener('click', async () => {
    stream = await navigator.mediaDevices.getUserMedia({ audio:true });
    chunks = [];
    const mime = MediaRecorder.isTypeSupported('audio/webm;codecs=opus') ? 'audio/webm;codecs=opus' : '';
    mr = new MediaRecorder(stream, mime ? { mimeType: mime } : undefined);
    mr.ondataavailable = e => { if (e.data?.size) chunks.push(e.data); };
    mr.onstop = () => {
      const blob = new Blob(chunks, { type: mime || 'audio/webm' });
      const url = URL.createObjectURL(blob);
      audio.src = url;
      audio.dataset.blobUrl = url;
      save.disabled = false;
    };
    mr.start();
    rec.disabled = true; stop.disabled = false; save.disabled = true;
  });
  stop.addEventListener('click', () => {
    if (mr && mr.state !== 'inactive') mr.stop();
    rec.disabled = false; stop.disabled = true;
  });
  save.addEventListener('click', () => {
    const a = document.createElement('a');
    a.href = audio.dataset.blobUrl; a.download = key + ".webm";
    document.body.appendChild(a); a.click(); a.remove();
  });
});
</script>
<!-- __mshare_asset_audio_player__ -->
<script>
(()=>{const A=new Audio();A.preload='auto';A.setAttribute('playsinline','');
let unlocked=false;document.addEventListener('click',async(e)=>{const el=e.target.closest('[data-say-asset]');if(!el)return;
try{if(!unlocked){const AC=window.AudioContext||window.webkitAudioContext;if(AC){const ac=new AC();const b=ac.createBuffer(1,1,22050);const s=ac.createBufferSource();s.buffer=b;s.connect(ac.destination);s.start(0);await ac.resume();}unlocked=true;}
A.src=el.getAttribute('data-say-asset');await A.play();}catch(err){console.error('asset-audio play failed',err);}});})();
</script>
</body>
</html>